import{r as c,j as d,F as M,a as n,b as ga,g as z,c as f}from"./app-54bba900.js";import{A as fa}from"./AuthenticatedLayout-630bc9da.js";import{A as va,S as Ra,B as wa}from"./Blok1_2-2fbce48c.js";import{D as Sa,W as Aa,B as Fa,a as Ta,b as ja,c as Ba,d as L}from"./Blok_QC-a92abd0c.js";import{M as Ma}from"./Modal-72c317ee.js";import{T as $}from"./TextRupiah-c5a72c91.js";import{F as x}from"./index-8da74228.js";import{m as xa}from"./index-9863aff3.js";import{S as b}from"./index-7988c5ce.js";import{B as E}from"./TextArea-9ac0aa49.js";import{T as G}from"./index-ac2727d1.js";import{S as Ea,T as O}from"./Table-8b77b588.js";import{T as Ia}from"./index-93a194ad.js";import{R as Ka}from"./ReloadOutlined-67910be5.js";import"./Sider-ba01838b.js";import"./AntdIcon-71a17da6.js";import"./index-1cd3745d.js";import"./KeyCode-6413d982.js";import"./index-5271d5fd.js";import"./debounce-f54583b8.js";import"./index-689e26bf.js";import"./addEventListener-8ec56d01.js";import"./CheckOutlined-e032d51b.js";import"./CloseOutlined-57ac73b0.js";import"./index-e8a5f194.js";import"./CONSTANT-29470937.js";import"./index-1dffff19.js";import"./index-3d3eb8c9.js";import"./index-82a29645.js";import"./RupiahInput-5fc16d9a.js";import"./lodash-5d07a22e.js";import"./index-3f7561be.js";const X=[{id:1,nomor:1,rincian:"Padi-padian (R.1)",type:"standar"},{id:2,nomor:2,rincian:"Umbi-umbian (R.8)",type:"standar"},{id:3,nomor:3,rincian:"Ikan/udang/cumi/kerang (R.16)",type:"standar"},{id:4,nomor:4,rincian:"Daging (R.55)",type:"standar"},{id:5,nomor:5,rincian:"Telur dan Susu (R.65)",type:"standar"},{id:6,nomor:6,rincian:"Sayur-sayuran (R.75)",type:"standar"},{id:7,nomor:7,rincian:"Kacang-kacangan (R.102)",type:"standar"},{id:8,nomor:8,rincian:"Buah-buahan (R.110)",type:"standar"},{id:9,nomor:9,rincian:"Minyak dan Kelapa (R.126)",type:"standar"},{id:10,nomor:10,rincian:"Bahan Minuman (R.131)",type:"standar"},{id:11,nomor:11,rincian:"Bumbu-bumbuan (R.139)",type:"standar"},{id:12,nomor:12,rincian:"Bahan Makanan Lainnya (R.154)",type:"standar"},{id:13,nomor:13,rincian:"Makanan dan Minuman Jadi (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:14,nomor:14,rincian:"Rokok dan Tembakau (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:15,nomor:15,rincian:"SUBJUMLAH [R.1 s.d. R.14]",type:"standar"},{id:16,nomor:16,rincian:"RATA-RATA PENGELUARAN MAKANAN SEBULAN [R.15 x 30/7]",type:"average"},{id:17,nomor:17,rincian:"RATA-RATA PENGELUARAN BUKAN MAKANAN SEBULAN [salin dari Blok 4.3.3 rincian 8 kolom 3]",type:"average"},{id:18,nomor:18,rincian:"RATA-RATA PENGELUARAN SEBULAN [R.16 + R17]",type:"average"}],Va=async(l,u,y,I)=>{const{data:v}=await f.get(route("api.mak.calculate_qc",{id_ruta:l}));let p=[...y];return p[0].value=v.kalori_total/u/7,p[1].value=v.jumlah_komoditas_bahan_makanan,p[2].value=v.jumlah_komoditas_makanan_jadi_rokok,p[3].value=I,p[4].value=p[1].value+p[2].value+p[3].value,p[5].value=Math.round(v.pengeluaran/u),p[6].value=v.kalori_basket/7/u,p},Ca=({data:l,konsumsi_ruta:u,art:y,garis_kemiskinan:I,rekap_konsumsi:v,rekap_konsumsi_art:p})=>{const R={backgroundColor:"#fff",paddingLeft:"10px",paddingRight:"10px",paddingBottom:"15px",width:"100%"},[m]=x.useForm(),[S]=x.useForm(),[aa]=x.useForm(),[A]=x.useForm(),[K,D]=c.useState(null),[g,j]=c.useState([]),[F,T]=c.useState(X.map(e=>({beli:0,produksi:0,total:0}))),[ea,U]=c.useState(!1),[H,ta]=c.useState([{rincian:"Kalori per Kapita per Hari",id:0,value:0,dataType:"decimal"},{rincian:"Kalori 52 basket komoditas per Kapita per Hari",id:6,value:0,dataType:"decimal"},{rincian:"Jumlah Komoditas Bahan Makanan/Minuman",id:1,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Makanan/Minuman Jadi dan Rokok",id:2,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Non Makanan [Disalin dari dokumen KP Blok III Rincian 305 ]",id:3,value:0,dataType:"integer"},{rincian:"Jumlah Semua Komoditas",id:4,value:0,dataType:"integer"},{rincian:"Pengeluaran per kapita",id:5,value:0,dataType:"rupiah"}]),[ia,oa]=c.useState(!1),[ra,J]=c.useState(!1),[V,na]=c.useState([]),[C,la]=c.useState([]),[N,sa]=c.useState([]),P=()=>{J(!1)},[w,da]=xa.useMessage(),B=async e=>{try{const i=route("entri.mak.update"),{data:o}=await f.patch(i,e,{headers:{"Content-Type":"application/json"}})}catch{console.error("error saving blok 1 and 2")}},ca=async e=>{try{const i=route("entri.mak.art.update"),o=await f.patch(i,e,{headers:{"Content-Type":"application/json"}})}catch{console.error("Oops terjadi kesalahan dalam menyimpan Kuesioner ART, silahkan hubungi admin")}},ua=async e=>{try{const i=route("entri.mak.konsumsi.store"),{data:o}=await f.patch(i,e,{headers:{"Content-Type":"application/json"}})}catch{w.open({type:"error",key:"4_1",content:"Oops terjadi kesalahan dalam mmenyimpan konsumsi, silahkan hubungi admin"})}},ka=async e=>{try{const i=route("api.entri.inti",e),{data:o}=await f.get(i)}catch{w.open({type:"error",key:"cari",content:"Oops terjadi kesalahan dalam menyimpan blok 4 1 art, silahkan hubungi admin"})}};function W(e){}const[pa,ma]=c.useState([]),[ha,La]=c.useState([{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0}]),_a=async e=>{const o=Object.entries(e).filter(([k,s])=>k.endsWith("volume")&&typeof s=="number"&&s>0).map(async k=>{let s=k[0].split("_")[0],a=Number(k[1])??0;try{const{data:h}=await f.get(route("api.mak.komoditas.kalori.fetch",{id:s}));return a*h}catch{return console.log("error ketika fetch data kalori"),0}});return(await Promise.all(o)).reduce((k,s)=>k+s,0)},q=async()=>{w.loading({content:"Menyimpan data",type:"loading",key:"simpan"});try{const[e,i,o]=await Promise.all([A.submit(),m.submit(),S.submit()]),k=(await f.get(route("api.mak.calculate_qc",{id_ruta:g[0].id_ruta}))).data,s=await Va(l.id,g.length,H,m.getFieldValue("blokqc_3"));ta([...s]),m.setFieldsValue({blokqc_0:s[0].value,blokqc_1:s[1].value,blokqc_2:s[2].value,blokqc_4:s[4].value,blokqc_5:s[5].value,blokqc_6:s[6].value}),D(new Date),z.get(route("entri.mak.edit",{id:l.id}),{},{preserveState:!0,preserveScroll:!0}),w.open({content:"Data berhasil tersimpan",type:"success",key:"simpan",duration:2})}catch{w.open({content:"Data gagal tersimpan",type:"error",key:"simpan",duration:2})}},Q=async()=>{await q();const e=m.getFieldValue("id");try{U(!0);const{data:i}=await f.get(route("api.mak.revalidasi",{id_ruta:e}));la([...i.evaluasi_rh]),sa([...i.daftar_error]),na([...i.daftar_warning]),w.open({content:"Revalidasi selesai",type:"success",key:"revalidasi"})}catch(i){console.error("Error submitting forms:",i)}finally{U(!1)}},ba=async()=>{const e=S.getFieldsValue();[0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,17].forEach(o=>{let r=[...F];const k=`beli_harga${o}`,s=Object.entries(e).filter(([t])=>t.endsWith(k)&&!t.includes("jumlah")).reduce((t,[,_])=>t+(_||0),0);r[o].beli=s;const a=`produksi_harga${o}`,h=Object.entries(e).filter(([t])=>t.endsWith(a)&&!t.includes("jumlah")).reduce((t,[,_])=>t+(_||0),0);r[o].produksi=h,o<=14&&(r[o].total=r[o].beli+r[o].produksi),r[14]=r.slice(0,14).reduce((t,_)=>({beli:t.beli+_.beli,produksi:t.produksi+_.produksi,total:t.total+_.total}),{beli:0,produksi:0,total:0}),r[15].total=Math.round(r[14].total*30/7),r[17].total=r[15].total+r[16].total,T(r)})};c.useEffect(()=>{let e=[...F];g==null||g.forEach((o,r)=>{A.setFieldValue(`${r}-id_art`,o.id),A.setFieldValue(`${r}-nama`,o.nama)});const i=g==null?void 0:g.reduce((o,r)=>(Object.values(r.rekap).forEach((k,s)=>{o[s]=o[s]||{beli:0,produksi:0,total:0},o[s].beli+=k.beli,o[s].produksi+=k.produksi,o[s].total+=k.total}),o),[]);e[12]=i?i[0]:0,e[13]=i?i[1]:0,e[14]=e.slice(0,14).reduce((o,r)=>({beli:r?o.beli+r.beli:0,produksi:r?o.produksi+r.produksi:0,total:r?o.total+r.total:0}),{beli:0,produksi:0,total:0}),e[15].total=Math.round(e[14].total*30/7),e[17].total=e[15].total+e[16].total,T(e)},[g]),c.useRef(!1);const ya=e=>{e.ctrlKey&&e.key==="s"&&(e.preventDefault(),m.submit())};return c.useEffect(()=>{(()=>{if(y=y.map(h=>({...h,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}})),y.length<1&&j(h=>[...h,{id:"",id_ruta:l.id,nama:l.r110,nomor_art:0,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}}]),y.length>0){var a=[...y];p.map(t=>({id_art:t.id_art,id_kelompok:t.id_kelompok,beli:Number(t.beli),produksi:Number(t.produksi)})).forEach(t=>(a=a.map(_=>(_.id===t.id_art&&(_.rekap[t.id_kelompok].produksi=t.produksi,_.rekap[t.id_kelompok].beli=t.beli,_.rekap[t.id_kelompok].total=t.beli+t.produksi),_)),t)),j(a)}})(),document.addEventListener("keydown",ya),m.setFieldsValue(l);let i=[...F];v.map(a=>({id_kelompok:a.id_kelompok,beli:Number(a.beli),produksi:Number(a.produksi)})).forEach(a=>{i[a.id_kelompok].beli=a.beli,i[a.id_kelompok].produksi=a.produksi,i[a.id_kelompok].total=a.produksi+a.beli}),i[16].total=l.blok4_32_16_total,T(i),m.setFieldValue("wtf_26",I),S.setFieldsValue({id_ruta:l.id,hal10_jml_komoditas:l.hal10_jml_komoditas??void 0,hal8_jml_komoditas:l.hal8_jml_komoditas??void 0,hal6_jml_komoditas:l.hal6_jml_komoditas??void 0,hal4_jml_komoditas:l.hal4_jml_komoditas??void 0,hal2_jml_komoditas:l.hal2_jml_komoditas??void 0});const r=[1,8,16],s=u.map(a=>({[`${r.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_beli_harga${a.id_kelompok}`]:a.harga_beli,[`${r.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_produksi_harga${a.id_kelompok}`]:a.harga_produksi,[`${a.id_komoditas}_total_harga`]:a.harga_total,[`${a.id_komoditas}_total_harga_calculated`]:a.harga_produksi+a.harga_beli,[`${a.id_komoditas}_item`]:a.item,[`${a.id_komoditas}_satuan`]:a.satuan,[`${a.id_komoditas}_beli_volume`]:a.volume_beli,[`${a.id_komoditas}_produksi_volume`]:a.volume_produksi,[`${a.id_komoditas}_total_volume`]:a.volume_total})).reduce((a,h)=>{for(const t in h)h.hasOwnProperty(t)&&(a[t]=h[t]);return a},{});S.setFieldsValue(s),A.setFieldsValue({id_ruta:l.id}),D(new Date(l.updated_at))},[]),d(M,{children:[da,n(ga,{title:"Entri Kuesioner Inti"}),d(b,{style:{width:"100%",minHeight:"300px",padding:"10px 15px"},direction:"vertical",children:[d(b,{style:{width:"100%",justifyContent:"space-between"},direction:"horizontal",children:[n(b,{children:d(E,{onClick:()=>z.get(route("entri",{kode_kabkot:m.getFieldValue("kode_kabkot"),nks:m.getFieldValue("nks"),semester:2})),children:[n(va,{})," Kembali"]})}),d(b,{direction:"horizontal",style:{width:"100%",justifyContent:"end"},children:["Last Saved :",(K==null?void 0:K.toLocaleDateString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}))||"Never",d(E,{type:"primary",onClick:q,children:[n(Ra,{})," Simpan"]}),d(E,{type:"primary",style:{backgroundColor:"#e64d00"},onClick:async()=>{J(!0),ia||(Q(),oa(!0))},children:[n(Sa,{}),"Evaluasi"]})]})]}),n(G,{onChange:W,type:"card",items:[{label:"Blok I, II",key:"1",children:n(wa,{tabContentStyle:R,form:m,onFinish:B,setDaftarArt:j,editable:!1,identitas_wilayah:{desa:l.desa,kode_desa:l.kode_desa,kec:l.kec,kode_kec:l.kode_kec}})},{label:"Worksheet",key:"2",children:n(Aa,{tabContentStyle:R,form:m,onFinish:B})},{label:"Blok IV.1",key:"3",children:n(Fa,{onFinish:ua,form:S,tabContentStyle:R,calculate:ba,subTotalHarga:ha,rekapMak:F,setRekapMak:T})},{label:"Blok IV.1 ART",key:"4",children:n(Ta,{tabContentStyle:R,form:aa,artForm:A,onFinish:ka,artFormFinish:ca,rekapArt:pa,setRekapArt:ma,daftarArt:g,setDaftarArt:j,calculateKalori:_a})},{label:"Blok IV.3",key:"5",children:n(ja,{tabContentStyle:R,form:m,onFinish:B,daftarArt:g,rekapMak:F,daftarRincian432:X,setRekapMak:T})},{label:"Blok QC",key:"6",children:n(Ba,{tabContentStyle:R,form:m,onFinish:B,daftarQc:H})}]})]}),d(Ma,{cancelText:"Tutup",okText:"",handleCancel:P,confirmLoadingModal:!1,openModal:ra,handleOk:P,title:"Daftar Evaluasi",width:"1200px",children:[d(b,{style:{marginBottom:"20px",width:"100%",justifyContent:"end"},children:[d(E,{type:"primary",onClick:Q,children:[n(Ka,{})," Revalidasi"]}),n(Z,{children:"Klik ini untuk melakukan revalidasi ulang"})]}),ea?d(b,{style:{width:"100%",justifyContent:"center"},direction:"vertical",children:[n(b,{style:{width:"100%",justifyContent:"center"},children:n(Ea,{size:"large"})}),n(b,{style:{width:"100%",justifyContent:"center"},children:"Sedang melakukan evaluasi terhadap isian, harap bersabar :)"})]}):n(b,{style:{width:"100%"},direction:"vertical",children:n(G,{onChange:W,type:"card",items:[{label:n(L,{count:N.length,children:"Error Isian"}),key:"1",children:d(M,{children:[d(b,{children:["Jumlah error :"," ",N.length]}),n(O,{bordered:!0,columns:Y,dataSource:N,style:{width:"100%"}})]})},{label:n(L,{count:V.length,color:"rgb(255, 204, 0)",children:"Warning Isian"}),key:"2",children:d(M,{children:[d(b,{children:["Jumlah warning :"," ",V.length]}),n(O,{bordered:!0,columns:Y,dataSource:V,style:{width:"100%"}})]})},{label:n(L,{count:C.length,color:"rgb(255, 204, 0)",children:"Warning Isian Range Harga"}),key:"3",children:d(M,{children:[d(b,{children:["Jumlah warning range harga :"," ",C.length]}),n(O,{bordered:!0,columns:Na,dataSource:C,style:{width:"100%"}})]})}]})})]},"range-harga-modal")]})},{Text:Z}=Ia,Na=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:10,render:(l,u,y)=>y+1},{title:"Komoditas",dataIndex:"komoditas",key:"komoditas",render:(l,u)=>`[${u.id_komoditas}] ${u.nama_komoditas}`},{title:"Harga per Satuan",dataIndex:"harga",key:"harga",width:"20%",render:l=>n($,{color:"#000",value:Number(l)})},{title:"Rincian",dataIndex:"rincian",key:"rincian",render:(l,u)=>d(Z,{children:[u.rincian,"(",n($,{value:u.min,color:"red"})," s.d",n($,{value:u.max,color:"red"}),")"]})}],Y=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:15,render:(l,u,y)=>y+1},{title:"Variabel",dataIndex:"variable",key:"variable"},{title:"Deskripsi",dataIndex:"rincian",key:"rincian"}];Ca.layout=l=>n(fa,{user:l.props.auth.user,header:n("h2",{className:"",children:"Dashboard"}),selectedKey:"entri",children:l});export{Ca as default};
