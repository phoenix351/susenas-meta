import{r as c,j as d,F as M,a as l,b as ga,g as z,c as f}from"./app-cade510b.js";import{A as fa}from"./AuthenticatedLayout-2e91c2e1.js";import{A as va,S as Ra,B as wa}from"./Blok1_2-b0a10508.js";import{D as Sa,W as Aa,B as Fa,a as Ta,b as ja,c as Ba,d as L}from"./Blok_QC-e6d04944.js";import{M as Ma}from"./Modal-283bab31.js";import{T as $}from"./TextRupiah-f2720f0c.js";import{F as x}from"./index-5ce765d1.js";import{m as xa}from"./index-b93aae69.js";import{S as y}from"./index-efbdf8f9.js";import{B as K}from"./index-beeaf8d9.js";import{T as G}from"./index-f72bb425.js";import{S as Ka,T as O}from"./Table-675fb605.js";import{T as Na}from"./index-821a731c.js";import{R as Ea}from"./ReloadOutlined-1936f950.js";import"./Sider-26ba9cdb.js";import"./AntdIcon-da8305e3.js";import"./LeftOutlined-a53789c4.js";import"./index-c911b603.js";import"./useForceUpdate-a75d9b98.js";import"./responsiveObserver-bed5db2e.js";import"./EllipsisOutlined-7069c36e.js";import"./Overflow-133b988e.js";import"./Keyframes-24838d9a.js";import"./useFlexGapSupport-8646280d.js";import"./KeyCode-6413d982.js";import"./EditOutlined-229e823d.js";import"./index-e3d5dafc.js";import"./index-af8f5ca6.js";import"./debounce-f85751c1.js";import"./index-f9258c5c.js";import"./pickAttrs-01b563d9.js";import"./TextArea-9a7525ca.js";import"./CloseCircleFilled-a13e8288.js";import"./CheckOutlined-c54abbe5.js";import"./CloseOutlined-0d8c520e.js";import"./index-b9cc14aa.js";import"./EyeOutlined-a718312b.js";import"./CONSTANT-6757a93f.js";import"./index-8f93d1ad.js";import"./addEventListener-61db0605.js";import"./index-54100e18.js";import"./index-8340b4b3.js";import"./Skeleton-5eb8e578.js";import"./RupiahInput-89582db5.js";import"./lodash-a1f3770e.js";import"./index-7d10e982.js";import"./ExclamationCircleFilled-1864351a.js";import"./ActionButton-0f136a84.js";import"./index-c24da6a1.js";import"./InfoCircleFilled-7f3ebebf.js";import"./PlusOutlined-975784f6.js";import"./Dropdown-531b1aaa.js";import"./styleChecker-9cc21804.js";import"./Title-821d3901.js";const X=[{id:1,nomor:1,rincian:"Padi-padian (R.1)",type:"standar"},{id:2,nomor:2,rincian:"Umbi-umbian (R.8)",type:"standar"},{id:3,nomor:3,rincian:"Ikan/udang/cumi/kerang (R.16)",type:"standar"},{id:4,nomor:4,rincian:"Daging (R.55)",type:"standar"},{id:5,nomor:5,rincian:"Telur dan Susu (R.65)",type:"standar"},{id:6,nomor:6,rincian:"Sayur-sayuran (R.75)",type:"standar"},{id:7,nomor:7,rincian:"Kacang-kacangan (R.102)",type:"standar"},{id:8,nomor:8,rincian:"Buah-buahan (R.110)",type:"standar"},{id:9,nomor:9,rincian:"Minyak dan Kelapa (R.126)",type:"standar"},{id:10,nomor:10,rincian:"Bahan Minuman (R.131)",type:"standar"},{id:11,nomor:11,rincian:"Bumbu-bumbuan (R.139)",type:"standar"},{id:12,nomor:12,rincian:"Bahan Makanan Lainnya (R.154)",type:"standar"},{id:13,nomor:13,rincian:"Makanan dan Minuman Jadi (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:14,nomor:14,rincian:"Rokok dan Tembakau (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:15,nomor:15,rincian:"SUBJUMLAH [R.1 s.d. R.14]",type:"standar"},{id:16,nomor:16,rincian:"RATA-RATA PENGELUARAN MAKANAN SEBULAN [R.15 x 30/7]",type:"average"},{id:17,nomor:17,rincian:"RATA-RATA PENGELUARAN BUKAN MAKANAN SEBULAN [salin dari Blok 4.3.3 rincian 8 kolom 3]",type:"average"},{id:18,nomor:18,rincian:"RATA-RATA PENGELUARAN MAKANAN SEBULAN [R.16 + R17]",type:"average"}],Ia=async(o,u,b,N)=>{const{data:v}=await f.get(route("api.mak.calculate_qc",{id_ruta:o}));let m=[...b];return m[0].value=v.kalori_total/u/7,m[1].value=v.jumlah_komoditas_bahan_makanan,m[2].value=v.jumlah_komoditas_makanan_jadi_rokok,m[3].value=N,m[4].value=m[1].value+m[2].value+m[3].value,m[5].value=Math.round(v.pengeluaran/u),m[6].value=v.kalori_basket/7/u,m},Va=({data:o,konsumsi_ruta:u,art:b,garis_kemiskinan:N,rekap_konsumsi:v,rekap_konsumsi_art:m})=>{const R={backgroundColor:"#fff",paddingLeft:"10px",paddingRight:"10px",paddingBottom:"15px",width:"100%"},[k]=x.useForm(),[S]=x.useForm(),[aa]=x.useForm(),[A]=x.useForm(),[E,D]=c.useState(null),[g,j]=c.useState([]),[F,T]=c.useState(X.map(e=>({beli:0,produksi:0,total:0}))),[ea,U]=c.useState(!1),[H,ta]=c.useState([{rincian:"Kalori per Kapita per Hari",id:0,value:0,dataType:"decimal"},{rincian:"Kalori 52 basket komoditas per Kapita per Hari",id:6,value:0,dataType:"decimal"},{rincian:"Jumlah Komoditas Bahan Makanan/Minuman",id:1,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Makanan/Minuman Jadi dan Rokok",id:2,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Non Makanan [Disalin dari dokumen KP Blok III Rincian 305 ]",id:3,value:0,dataType:"integer"},{rincian:"Jumlah Semua Komoditas",id:4,value:0,dataType:"integer"},{rincian:"Pengeluaran per kapita",id:5,value:0,dataType:"rupiah"}]),[ia,oa]=c.useState(!1),[ra,J]=c.useState(!1),[I,na]=c.useState([]),[V,la]=c.useState([]),[C,sa]=c.useState([]),P=()=>{J(!1)},[w,da]=xa.useMessage(),B=async e=>{try{const i=route("entri.mak.update"),{data:r}=await f.patch(i,e,{headers:{"Content-Type":"application/json"}})}catch{console.error("error saving blok 1 and 2")}},ca=async e=>{try{const i=route("entri.mak.art.update"),r=await f.patch(i,e,{headers:{"Content-Type":"application/json"}})}catch{console.error("Oops terjadi kesalahan dalam menyimpan Kuesioner ART, silahkan hubungi admin")}},ua=async e=>{try{const i=route("entri.mak.konsumsi.store"),{data:r}=await f.patch(i,e,{headers:{"Content-Type":"application/json"}})}catch{w.open({type:"error",key:"4_1",content:"Oops terjadi kesalahan dalam mmenyimpan konsumsi, silahkan hubungi admin"})}},pa=async e=>{try{const i=route("api.entri.inti",e),{data:r}=await f.get(i)}catch{w.open({type:"error",key:"cari",content:"Oops terjadi kesalahan dalam menyimpan blok 4 1 art, silahkan hubungi admin"})}};function W(e){}const[ma,ka]=c.useState([]),[ha,La]=c.useState([{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0}]),_a=async e=>{const r=Object.entries(e).filter(([p,s])=>p.endsWith("volume")&&typeof s=="number"&&s>0).map(async p=>{let s=p[0].split("_")[0],a=Number(p[1])??0;try{const{data:h}=await f.get(route("api.mak.komoditas.kalori.fetch",{id:s}));return a*h}catch{return console.log("error ketika fetch data kalori"),0}});return(await Promise.all(r)).reduce((p,s)=>p+s,0)},q=async()=>{w.loading({content:"Menyimpan data",type:"loading",key:"simpan"});try{const[e,i,r]=await Promise.all([A.submit(),k.submit(),S.submit()]),p=(await f.get(route("api.mak.calculate_qc",{id_ruta:g[0].id_ruta}))).data,s=await Ia(o.id,g.length,H,k.getFieldValue("blokqc_3"));ta([...s]),k.setFieldsValue({blokqc_0:s[0].value,blokqc_1:s[1].value,blokqc_2:s[2].value,blokqc_4:s[4].value,blokqc_5:s[5].value,blokqc_6:s[6].value}),D(new Date),z.get(route("entri.mak.edit",{id:o.id}),{},{preserveState:!0,preserveScroll:!0}),w.open({content:"Data berhasil tersimpan",type:"success",key:"simpan",duration:2})}catch{w.open({content:"Data gagal tersimpan",type:"error",key:"simpan",duration:2})}},Q=async()=>{await q();const e=k.getFieldValue("id");try{U(!0);const{data:i}=await f.get(route("api.mak.revalidasi",{id_ruta:e}));la([...i.evaluasi_rh]),sa([...i.daftar_error]),na([...i.daftar_warning]),w.open({content:"Revalidasi selesai",type:"success",key:"revalidasi"})}catch(i){console.error("Error submitting forms:",i)}finally{U(!1)}},ya=async()=>{const e=S.getFieldsValue();[0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,17].forEach(r=>{let n=[...F];const p=`beli_harga${r}`,s=Object.entries(e).filter(([t])=>t.endsWith(p)&&!t.includes("jumlah")).reduce((t,[,_])=>t+(_||0),0);n[r].beli=s;const a=`produksi_harga${r}`,h=Object.entries(e).filter(([t])=>t.endsWith(a)&&!t.includes("jumlah")).reduce((t,[,_])=>t+(_||0),0);n[r].produksi=h,r<=14&&(n[r].total=n[r].beli+n[r].produksi),n[14]=n.slice(0,14).reduce((t,_)=>({beli:t.beli+_.beli,produksi:t.produksi+_.produksi,total:t.total+_.total}),{beli:0,produksi:0,total:0}),n[15].total=Math.round(n[14].total*30/7),n[17].total=n[15].total+n[16].total,T(n)})};c.useEffect(()=>{let e=[...F];g==null||g.forEach((r,n)=>{A.setFieldValue(`${n}-id_art`,r.id),A.setFieldValue(`${n}-nama`,r.nama)});const i=g==null?void 0:g.reduce((r,n)=>(Object.values(n.rekap).forEach((p,s)=>{r[s]=r[s]||{beli:0,produksi:0,total:0},r[s].beli+=p.beli,r[s].produksi+=p.produksi,r[s].total+=p.total}),r),[]);e[12]=i?i[0]:0,e[13]=i?i[1]:0,e[14]=e.slice(0,14).reduce((r,n)=>({beli:n?r.beli+n.beli:0,produksi:n?r.produksi+n.produksi:0,total:n?r.total+n.total:0}),{beli:0,produksi:0,total:0}),e[15].total=Math.round(e[14].total*30/7),e[17].total=e[15].total+e[16].total,T(e)},[g]),c.useRef(!1);const ba=e=>{e.ctrlKey&&e.key==="s"&&(e.preventDefault(),k.submit())};return c.useEffect(()=>{(()=>{if(b=b.map(h=>({...h,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}})),b.length<1&&j(h=>[...h,{id:"",id_ruta:o.id,nama:o.r110,nomor_art:0,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}}]),b.length>0){var a=[...b];m.map(t=>({id_art:t.id_art,id_kelompok:t.id_kelompok,beli:Number(t.beli),produksi:Number(t.produksi)})).forEach(t=>(a=a.map(_=>(_.id===t.id_art&&(_.rekap[t.id_kelompok].produksi=t.produksi,_.rekap[t.id_kelompok].beli=t.beli,_.rekap[t.id_kelompok].total=t.beli+t.produksi),_)),t)),j(a)}})(),document.addEventListener("keydown",ba),k.setFieldsValue(o);let i=[...F];v.map(a=>({id_kelompok:a.id_kelompok,beli:Number(a.beli),produksi:Number(a.produksi)})).forEach(a=>{i[a.id_kelompok].beli=a.beli,i[a.id_kelompok].produksi=a.produksi,i[a.id_kelompok].total=a.produksi+a.beli}),i[16].total=o.blok4_32_16_total,T(i),k.setFieldValue("wtf_26",N),S.setFieldsValue({id_ruta:o.id,hal10_jml_komoditas:o.hal10_jml_komoditas??void 0,hal8_jml_komoditas:o.hal8_jml_komoditas??void 0,hal6_jml_komoditas:o.hal6_jml_komoditas??void 0,hal4_jml_komoditas:o.hal4_jml_komoditas??void 0,hal2_jml_komoditas:o.hal2_jml_komoditas??void 0});const n=[1,8,16],s=u.map(a=>({[`${n.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_beli_harga${a.id_kelompok}`]:a.harga_beli,[`${n.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_produksi_harga${a.id_kelompok}`]:a.harga_produksi,[`${a.id_komoditas}_total_harga`]:a.harga_total,[`${a.id_komoditas}_item`]:a.item,[`${a.id_komoditas}_satuan`]:a.satuan,[`${a.id_komoditas}_beli_volume`]:a.volume_beli,[`${a.id_komoditas}_produksi_volume`]:a.volume_produksi,[`${a.id_komoditas}_total_volume`]:a.volume_total})).reduce((a,h)=>{for(const t in h)h.hasOwnProperty(t)&&(a[t]=h[t]);return a},{});S.setFieldsValue(s),A.setFieldsValue({id_ruta:o.id}),D(new Date(o.updated_at))},[]),d(M,{children:[da,l(ga,{title:"Entri Kuesioner Inti"}),d(y,{style:{width:"100%",minHeight:"300px",padding:"10px 15px"},direction:"vertical",children:[d(y,{style:{width:"100%",justifyContent:"space-between"},direction:"horizontal",children:[l(y,{children:d(K,{onClick:()=>z.get(route("entri",{kode_kabkot:k.getFieldValue("kode_kabkot"),nks:k.getFieldValue("nks")})),children:[l(va,{})," Kembali"]})}),d(y,{direction:"horizontal",style:{width:"100%",justifyContent:"end"},children:["Last Saved :",(E==null?void 0:E.toLocaleDateString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}))||"Never",d(K,{type:"primary",onClick:q,children:[l(Ra,{})," Simpan"]}),d(K,{type:"primary",style:{backgroundColor:"#e64d00"},onClick:async()=>{J(!0),ia||(Q(),oa(!0))},children:[l(Sa,{}),"Evaluasi"]})]})]}),l(G,{onChange:W,type:"card",items:[{label:"Blok I, II",key:"1",children:l(wa,{tabContentStyle:R,form:k,onFinish:B,setDaftarArt:j,editable:!1,identitas_wilayah:{desa:o.desa,kode_desa:o.kode_desa,kec:o.kec,kode_kec:o.kode_kec}})},{label:"Worksheet",key:"2",children:l(Aa,{tabContentStyle:R,form:k,onFinish:B})},{label:"Blok IV.1",key:"3",children:l(Fa,{onFinish:ua,form:S,tabContentStyle:R,calculate:ya,subTotalHarga:ha,rekapMak:F,setRekapMak:T})},{label:"Blok IV.1 ART",key:"4",children:l(Ta,{id_ruta:o.id,tabContentStyle:R,form:aa,artForm:A,onFinish:pa,artFormFinish:ca,rekapArt:ma,setRekapArt:ka,daftarArt:g,setDaftarArt:j,calculateKalori:_a})},{label:"Blok IV.3",key:"5",children:l(ja,{tabContentStyle:R,form:k,onFinish:B,daftarArt:g,rekapMak:F,daftarRincian432:X,setRekapMak:T})},{label:"Blok QC",key:"6",children:l(Ba,{tabContentStyle:R,form:k,onFinish:B,daftarQc:H})}]})]}),d(Ma,{cancelText:"Tutup",okText:"",handleCancel:P,confirmLoadingModal:!1,openModal:ra,handleOk:P,title:"Daftar Evaluasi",width:"1200px",children:[d(y,{style:{marginBottom:"20px",width:"100%",justifyContent:"end"},children:[d(K,{type:"primary",onClick:Q,children:[l(Ea,{})," Revalidasi"]}),l(Z,{children:"Klik ini untuk melakukan revalidasi ulang"})]}),ea?d(y,{style:{width:"100%",justifyContent:"center"},direction:"vertical",children:[l(y,{style:{width:"100%",justifyContent:"center"},children:l(Ka,{size:"large"})}),l(y,{style:{width:"100%",justifyContent:"center"},children:"Sedang melakukan evaluasi terhadap isian, harap bersabar :)"})]}):l(y,{style:{width:"100%"},direction:"vertical",children:l(G,{onChange:W,type:"card",items:[{label:l(L,{count:C.length,children:"Error Isian"}),key:"1",children:d(M,{children:[d(y,{children:["Jumlah error :"," ",C.length]}),l(O,{bordered:!0,columns:Y,dataSource:C,style:{width:"100%"}})]})},{label:l(L,{count:I.length,color:"rgb(255, 204, 0)",children:"Warning Isian"}),key:"2",children:d(M,{children:[d(y,{children:["Jumlah warning :"," ",I.length]}),l(O,{bordered:!0,columns:Y,dataSource:I,style:{width:"100%"}})]})},{label:l(L,{count:V.length,color:"rgb(255, 204, 0)",children:"Warning Isian Range Harga"}),key:"3",children:d(M,{children:[d(y,{children:["Jumlah warning range harga :"," ",V.length]}),l(O,{bordered:!0,columns:Ca,dataSource:V,style:{width:"100%"}})]})}]})})]},"range-harga-modal")]})},{Text:Z}=Na,Ca=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:10,render:(o,u,b)=>b+1},{title:"Komoditas",dataIndex:"komoditas",key:"komoditas",render:(o,u)=>`[${u.id_komoditas}] ${u.nama_komoditas}`},{title:"Harga per Satuan",dataIndex:"harga",key:"harga",width:"20%",render:o=>l($,{color:"#000",value:Number(o)})},{title:"Rincian",dataIndex:"rincian",key:"rincian",render:(o,u)=>d(Z,{children:[u.rincian,"(",l($,{value:u.min,color:"red"})," s.d",l($,{value:u.max,color:"red"}),")"]})}],Y=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:15,render:(o,u,b)=>b+1},{title:"Variabel",dataIndex:"variable",key:"variable"},{title:"Deskripsi",dataIndex:"rincian",key:"rincian"}];Va.layout=o=>l(fa,{user:o.props.auth.user,header:l("h2",{className:"",children:"Dashboard"}),selectedKey:"entri",children:o});export{Va as default};
