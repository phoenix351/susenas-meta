import{r as d,c as F,j as p,a as o,F as V,b as Ra,g as Z}from"./app-cade510b.js";import{A as Sa}from"./AuthenticatedLayout-2e91c2e1.js";import{A as Fa,S as Aa,B as ja}from"./Blok1_2-b0a10508.js";import{D as Ba,W as Ta,B as Ma,a as xa,b as Na,c as Ia,d as H}from"./Blok_QC-e6d04944.js";import{M as Ca}from"./Modal-283bab31.js";import{T as U}from"./TextRupiah-f2720f0c.js";import{R as Ea}from"./RupiahInput-89582db5.js";import{l as Va}from"./lodash-a1f3770e.js";import{F as x}from"./index-5ce765d1.js";import{S as v}from"./index-efbdf8f9.js";import{T as K,S as $a}from"./Table-675fb605.js";import{m as aa}from"./index-b93aae69.js";import{B as $}from"./index-beeaf8d9.js";import{T as ea}from"./index-f72bb425.js";import{T as Ka}from"./index-821a731c.js";import{R as La}from"./ReloadOutlined-1936f950.js";import"./Sider-26ba9cdb.js";import"./AntdIcon-da8305e3.js";import"./LeftOutlined-a53789c4.js";import"./index-c911b603.js";import"./useForceUpdate-a75d9b98.js";import"./responsiveObserver-bed5db2e.js";import"./EllipsisOutlined-7069c36e.js";import"./Overflow-133b988e.js";import"./Keyframes-24838d9a.js";import"./useFlexGapSupport-8646280d.js";import"./KeyCode-6413d982.js";import"./EditOutlined-229e823d.js";import"./index-e3d5dafc.js";import"./index-af8f5ca6.js";import"./debounce-f85751c1.js";import"./index-f9258c5c.js";import"./pickAttrs-01b563d9.js";import"./TextArea-9a7525ca.js";import"./CloseCircleFilled-a13e8288.js";import"./CheckOutlined-c54abbe5.js";import"./CloseOutlined-0d8c520e.js";import"./index-b9cc14aa.js";import"./EyeOutlined-a718312b.js";import"./CONSTANT-6757a93f.js";import"./index-8f93d1ad.js";import"./addEventListener-61db0605.js";import"./index-54100e18.js";import"./index-8340b4b3.js";import"./Skeleton-5eb8e578.js";import"./index-7d10e982.js";import"./ExclamationCircleFilled-1864351a.js";import"./ActionButton-0f136a84.js";import"./index-c24da6a1.js";import"./InfoCircleFilled-7f3ebebf.js";import"./styleChecker-9cc21804.js";import"./Dropdown-531b1aaa.js";import"./PlusOutlined-975784f6.js";import"./Title-821d3901.js";const Da=({dataSource:e,id_ruta:c})=>{const[h,j]=d.useState("Belum ada perubahan"),[_]=x.useForm(),u=[{title:"No.",dataIndex:"id",key:"id"},{title:"Nama Komoditas",dataIndex:"nama_komoditas",key:"nama_komoditas"},{title:"Nilai Konsumsi (Rp)",dataIndex:"nilai",key:"nilai",render:(g,S)=>o(Ea,{inputName:`${S.id}-harga`,onChange:f=>{f&&f>=1e7?_.setFields([{name:`${S.id}-harga`,warnings:["Harga diatas batas wajar Rp 10.000.000"]}]):_.setFields([{name:`${S.id}-harga`,warnings:[]}])}})}],A=Va.debounce(async(g,S)=>{try{j("sedang menyimpan perubahan");const f=Object.keys(g)[0].split("-")[0],w=Object.values(g)[0],T={id_ruta:S,id_komoditas:f,harga:w},R=await F.post(route("api.non_mak.konsumsi.store"),T);j("perubahan tersimpan")}catch(f){j("error ketika menyimpan data"),console.log("error when saving data",f)}},1e3);async function k(g){try{const{data:S}=await F.get(route("api.non_mak.konsumsi.fetch",{id_ruta:g})),f=[...e];S.forEach(w=>{const T=`${w.id_komoditas}-harga`;_.setFieldValue(T,w.harga),w.harga&&w.harga>=1e7?_.setFields([{name:`${w.id_komoditas}-harga`,warnings:["Harga diatas batas wajar Rp 10.000.000"]}]):_.setFields([{name:`${w.id_komoditas}-harga`,warnings:[]}])})}catch(S){console.log("error when loading data",S)}finally{}}return d.useEffect(()=>{k(c)},[e]),p(v,{direction:"vertical",style:{width:"100%"},children:[h,o(x,{form:_,onValuesChange:g=>A(g,c),children:o(K,{pagination:{position:["topLeft"]},dataSource:e,columns:u})})]})},Oa=({id_ruta:e})=>{d.useState(!1);const[c,h]=d.useState([]);async function j(_){try{const{data:u}=await F.get(route("api.non_mak.komoditas.list"));h(u.map(A=>({...A,harga:0})))}catch(u){console.log("error fetch data",u)}}return d.useEffect(()=>{j()},[]),o(Da,{dataSource:c,id_ruta:e})},ta=[{id:1,nomor:1,rincian:"Padi-padian (R.1)",type:"standar"},{id:2,nomor:2,rincian:"Umbi-umbian (R.8)",type:"standar"},{id:3,nomor:3,rincian:"Ikan/udang/cumi/kerang (R.16)",type:"standar"},{id:4,nomor:4,rincian:"Daging (R.55)",type:"standar"},{id:5,nomor:5,rincian:"Telur dan Susu (R.65)",type:"standar"},{id:6,nomor:6,rincian:"Sayur-sayuran (R.75)",type:"standar"},{id:7,nomor:7,rincian:"Kacang-kacangan (R.102)",type:"standar"},{id:8,nomor:8,rincian:"Buah-buahan (R.110)",type:"standar"},{id:9,nomor:9,rincian:"Minyak dan Kelapa (R.126)",type:"standar"},{id:10,nomor:10,rincian:"Bahan Minuman (R.131)",type:"standar"},{id:11,nomor:11,rincian:"Bumbu-bumbuan (R.139)",type:"standar"},{id:12,nomor:12,rincian:"Bahan Makanan Lainnya (R.154)",type:"standar"},{id:13,nomor:13,rincian:"Makanan dan Minuman Jadi (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:14,nomor:14,rincian:"Rokok dan Tembakau (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:15,nomor:15,rincian:"SUBJUMLAH [R.1 s.d. R.14]",type:"standar"},{id:16,nomor:16,rincian:"RATA-RATA PENGELUARAN MAKANAN SEBULAN [R.15 x 30/7]",type:"average"},{id:17,nomor:17,rincian:"RATA-RATA PENGELUARAN BUKAN MAKANAN SEBULAN [salin dari Blok 4.3.3 rincian 8 kolom 3]",type:"average"},{id:18,nomor:18,rincian:"RATA-RATA PENGELUARAN SEBULAN [R.16 + R17]",type:"average"}],Ha=async(e,c,h,j)=>{const{data:_}=await F.get(route("api.mak.calculate_qc",{id_ruta:e}));let u=[...h];return u[0].value=_.kalori_total/c/7,u[1].value=_.jumlah_komoditas_bahan_makanan,u[2].value=_.jumlah_komoditas_makanan_jadi_rokok,u[3].value=j,u[4].value=u[1].value+u[2].value+u[3].value,u[5].value=Math.round(_.pengeluaran/c),u[6].value=_.kalori_basket/7/c,u},Ua=({data:e,konsumsi_ruta:c,art:h,garis_kemiskinan:j,rekap_konsumsi:_,rekap_konsumsi_art:u})=>{const A={backgroundColor:"#fff",paddingLeft:"10px",paddingRight:"10px",paddingBottom:"15px",width:"100%"},[k]=x.useForm(),[g]=x.useForm(),[S]=x.useForm(),[f]=x.useForm(),[w,T]=d.useState(null),[R,C]=d.useState([]),[N,I]=d.useState(ta.map(t=>({beli:0,produksi:0,total:0}))),[ra,J]=d.useState(!1),[P,na]=d.useState([{rincian:"Kalori per Kapita per Hari",id:0,value:0,dataType:"decimal"},{rincian:"Kalori 52 basket komoditas per Kapita per Hari",id:6,value:0,dataType:"decimal"},{rincian:"Jumlah Komoditas Bahan Makanan/Minuman",id:1,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Makanan/Minuman Jadi dan Rokok",id:2,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Non Makanan [Disalin dari dokumen KP Blok III Rincian 305 ]",id:3,value:0,dataType:"integer",editable:!0},{rincian:"Jumlah Semua Komoditas",id:4,value:0,dataType:"integer"},{rincian:"Pengeluaran per kapita",id:5,value:0,dataType:"rupiah"}]),[sa,la]=d.useState(!1),[da,W]=d.useState(!1),[L,ca]=d.useState([]),[D,ua]=d.useState([]),[O,pa]=d.useState([]),q=()=>{W(!1)},[B,ma]=aa.useMessage(),E=async t=>{try{const r=route("entri.mak.update"),i=await F.patch(r,t,{headers:{"Content-Type":"application/json"}})}catch(r){r.response.status===403&&aa.error({content:"Akun anda tidak boleh mengubah isian ini",key:"403-forbidden",duration:2e3})}},ka=async t=>{try{const r=route("entri.mak.art.update"),i=await F.patch(r,t,{headers:{"Content-Type":"application/json"}})}catch{console.error("Oops terjadi kesalahan dalam menyimpan Kuesioner ART, silahkan hubungi admin")}},ha=async t=>{try{const r=route("entri.mak.konsumsi.store"),{data:i}=await F.patch(r,t,{headers:{"Content-Type":"application/json"}})}catch{B.open({type:"error",key:"4_1",content:"Oops terjadi kesalahan dalam mmenyimpan konsumsi, silahkan hubungi admin"})}},_a=async t=>{try{const r=route("api.entri.inti",t),{data:i}=await F.get(r)}catch{B.open({type:"error",key:"cari",content:"Oops terjadi kesalahan dalam menyimpan blok 4 1 art, silahkan hubungi admin"})}};function Q(t){}const[ba,ya]=d.useState([]),[ga,Pa]=d.useState([{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0}]),fa=async t=>{const i=Object.entries(t).filter(([b,m])=>b.endsWith("volume")&&typeof m=="number"&&m>0).map(async b=>{let m=b[0].split("_")[0],a=Number(b[1])??0;try{const{data:l}=await F.get(route("api.mak.komoditas.kalori.fetch",{id:m}));return a*l}catch{return console.log("error ketika fetch data kalori"),0}});return(await Promise.all(i)).reduce((b,m)=>b+m,0)},z=async()=>{var t,r;B.loading({content:"Menyimpan data",type:"loading",key:"simpan"});try{const[i,s,b]=await Promise.all([f.submit(),k.submit(),g.submit()]);if(k.getFieldValue("r203")>1){B.open({content:"Data berhasil tersimpan",type:"success",key:"simpan",duration:2});return}const a=(await F.get(route("api.mak.calculate_qc",{id_ruta:R[0].id_ruta}))).data,l=await Ha(e.id,R.length,P,k.getFieldValue("blokqc_3"));na([...l]),k.setFieldsValue({blokqc_0:l[0].value,blokqc_1:l[1].value,blokqc_2:l[2].value,blokqc_4:l[4].value,blokqc_5:l[5].value,blokqc_6:l[6].value}),T(new Date),Z.get(route("entri.mak.edit",{id:e.id}),{},{preserveState:!0,preserveScroll:!0}),B.open({content:"Data berhasil tersimpan",type:"success",key:"simpan",duration:2})}catch(i){if((r=(t=i==null?void 0:i.response)==null?void 0:t.data)!=null&&r.error){let s=i.response.data.error;B.open({content:s??"Data gagal tersimpan",type:"error",key:"simpan",duration:2})}}},G=async()=>{await z();const t=k.getFieldValue("id");try{J(!0);const{data:r}=await F.get(route("api.mak.revalidasi",{id_ruta:t}));ua([...r.evaluasi_rh]),pa([...r.daftar_error]),ca([...r.daftar_warning]),B.open({content:"Revalidasi selesai",type:"success",key:"revalidasi"})}catch(r){console.error("Error submitting forms:",r)}finally{J(!1)}},va=async()=>{const t=g.getFieldsValue();[0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,17].forEach(i=>{let s=[...N];const b=`beli_harga${i}`,m=Object.entries(t).filter(([n])=>n.endsWith(b)&&!n.includes("jumlah")).reduce((n,[,y])=>n+(y||0),0);s[i].beli=m;const a=`produksi_harga${i}`,l=Object.entries(t).filter(([n])=>n.endsWith(a)&&!n.includes("jumlah")).reduce((n,[,y])=>n+(y||0),0);s[i].produksi=l,i<=14&&(s[i].total=s[i].beli+s[i].produksi),s[14]=s.slice(0,14).reduce((n,y)=>({beli:n.beli+y.beli,produksi:n.produksi+y.produksi,total:n.total+y.total}),{beli:0,produksi:0,total:0}),s[15].total=Math.round(s[14].total*30/7),s[17].total=s[15].total+s[16].total,I(s)})};d.useEffect(()=>{let t=[...N];R==null||R.forEach((i,s)=>{f.setFieldValue(`${s}-id_art`,i.id),f.setFieldValue(`${s}-nama`,i.nama)});const r=R==null?void 0:R.reduce((i,s)=>(Object.values(s.rekap).forEach((b,m)=>{i[m]=i[m]||{beli:0,produksi:0,total:0},i[m].beli+=b.beli,i[m].produksi+=b.produksi,i[m].total+=b.total}),i),[]);t[12]=r?r[0]:0,t[13]=r?r[1]:0,t[14]=t.slice(0,14).reduce((i,s)=>({beli:s?i.beli+s.beli:0,produksi:s?i.produksi+s.produksi:0,total:s?i.total+s.total:0}),{beli:0,produksi:0,total:0}),t[15].total=Math.round(t[14].total*30/7),t[17].total=t[15].total+t[16].total,I(t)},[R]),d.useRef(!1);const wa=t=>{t.ctrlKey&&t.key==="s"&&(t.preventDefault(),k.submit())};d.useEffect(()=>{(()=>{if(h=h.map(l=>({...l,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}})),h.length<1&&C(l=>[...l,{id:"",id_ruta:e.id,nama:e.r110,nomor_art:0,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}}]),h.length>0){var a=[...h];u.map(n=>({id_art:n.id_art,id_kelompok:n.id_kelompok,beli:Number(n.beli),produksi:Number(n.produksi)})).forEach(n=>(a=a.map(y=>{if(y.id===n.id_art)try{y.rekap[n.id_kelompok].produksi=n.produksi,y.rekap[n.id_kelompok].beli=n.beli,y.rekap[n.id_kelompok].total=n.beli+n.produksi}catch{console.log({element:n,art:y})}return y}),n)),C(a)}})(),document.addEventListener("keydown",wa),k.setFieldsValue(e);let r=[...N];_.map(a=>({id_kelompok:a.id_kelompok,beli:Number(a.beli),produksi:Number(a.produksi)})).forEach(a=>{r[a.id_kelompok].beli=a.beli,r[a.id_kelompok].produksi=a.produksi,r[a.id_kelompok].total=a.produksi+a.beli}),r[16].total=e.blok4_32_16_total,I(r),k.setFieldValue("wtf_26",j),g.setFieldsValue({id_ruta:e.id,hal10_jml_komoditas:e.hal10_jml_komoditas??void 0,hal8_jml_komoditas:e.hal8_jml_komoditas??void 0,hal6_jml_komoditas:e.hal6_jml_komoditas??void 0,hal4_jml_komoditas:e.hal4_jml_komoditas??void 0,hal2_jml_komoditas:e.hal2_jml_komoditas??void 0});const s=[1,8,16],m=c.map(a=>({[`${s.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_beli_harga${a.id_kelompok}`]:a.harga_beli,[`${s.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_produksi_harga${a.id_kelompok}`]:a.harga_produksi,[`${a.id_komoditas}_total_harga`]:a.harga_total,[`${a.id_komoditas}_total_harga_calculated`]:a.harga_produksi+a.harga_beli,[`${a.id_komoditas}_item`]:a.item,[`${a.id_komoditas}_satuan`]:a.satuan,[`${a.id_komoditas}_beli_volume`]:a.volume_beli,[`${a.id_komoditas}_produksi_volume`]:a.volume_produksi,[`${a.id_komoditas}_total_volume`]:a.volume_total})).reduce((a,l)=>{for(const n in l)l.hasOwnProperty(n)&&(a[n]=l[n]);return a},{});g.setFieldsValue(m),f.setFieldsValue({id_ruta:e.id}),T(new Date(e.updated_at)),Y(e.r203)},[]);const[M,X]=d.useState(!0);function Y(t){if(t=="1"){X(!0);return}X(!1)}return p(V,{children:[ma,o(Ra,{title:"Entri Kuesioner Inti"}),p(v,{style:{width:"100%",minHeight:"300px",padding:"10px 15px"},direction:"vertical",children:[p(v,{style:{width:"100%",justifyContent:"space-between"},direction:"horizontal",children:[o(v,{children:p($,{onClick:()=>Z.get(route("entri",{kode_kabkot:k.getFieldValue("kode_kabkot"),nks:k.getFieldValue("nks"),semester:1})),children:[o(Fa,{})," Kembali"]})}),p(v,{direction:"horizontal",style:{width:"100%",justifyContent:"end"},children:["Last Saved :",(w==null?void 0:w.toLocaleDateString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}))||"Never",p($,{type:"primary",onClick:z,children:[o(Aa,{})," Simpan"]}),p($,{type:"primary",style:{backgroundColor:"#e64d00"},onClick:async()=>{W(!0),sa||(G(),la(!0))},children:[o(Ba,{}),"Evaluasi"]})]})]}),o(ea,{onChange:Q,type:"card",items:[{label:"Blok I, II",key:"1",children:o(ja,{ubahStatusCacah:Y,tabContentStyle:A,form:k,onFinish:E,setDaftarArt:C,editable:!1,identitas_wilayah:{desa:e.desa,kode_desa:e.kode_desa,kec:e.kec,kode_kec:e.kode_kec}})},{label:"Worksheet",key:"2",children:o(Ta,{tabContentStyle:A,form:k,onFinish:E}),disabled:!M},{label:"Blok IV.1",key:"3",children:o(Ma,{onFinish:ha,form:g,tabContentStyle:A,calculate:va,subTotalHarga:ga,rekapMak:N,setRekapMak:I}),disabled:!M},{label:"Blok IV.1 ART",key:"4",children:o(xa,{id_ruta:e.id,tabContentStyle:A,form:S,artForm:f,onFinish:_a,artFormFinish:ka,rekapArt:ba,setRekapArt:ya,daftarArt:R,setDaftarArt:C,calculateKalori:fa}),disabled:!M},{label:"Non Makanan",key:"7",children:o(Oa,{id_ruta:e.id}),disabled:!M},{label:"Blok IV.3",key:"5",children:o(Na,{tabContentStyle:A,form:k,onFinish:E,daftarArt:R,rekapMak:N,daftarRincian432:ta,setRekapMak:I}),disabled:!M},{label:"Blok QC",key:"6",children:o(Ia,{tabContentStyle:A,form:k,onFinish:E,daftarQc:P}),disabled:!M}]})]}),p(Ca,{cancelText:"Tutup",okText:"",handleCancel:q,confirmLoadingModal:!1,openModal:da,handleOk:q,title:"Daftar Evaluasi",width:"1200px",noFooter:!0,children:[p(v,{style:{marginBottom:"20px",width:"100%",justifyContent:"end"},children:[p($,{type:"primary",onClick:G,children:[o(La,{})," Revalidasi"]}),o(oa,{children:"Klik ini untuk melakukan revalidasi ulang"})]}),ra?p(v,{style:{width:"100%",justifyContent:"center"},direction:"vertical",children:[o(v,{style:{width:"100%",justifyContent:"center"},children:o($a,{size:"large"})}),o(v,{style:{width:"100%",justifyContent:"center"},children:"Sedang melakukan evaluasi terhadap isian, harap bersabar :)"})]}):o(v,{style:{width:"100%"},direction:"vertical",children:o(ea,{onChange:Q,type:"card",tabBarStyle:{padding:0,margin:0},items:[{label:o(H,{count:O.length,children:"Error Isian"}),key:"1",children:p(V,{children:[p(v,{children:["Jumlah error :"," ",O.length]}),o(K,{bordered:!0,columns:ia,dataSource:O,style:{width:"100%"}})]})},{label:o(H,{count:L.length,color:"rgb(255, 204, 0)",children:"Warning Isian"}),key:"2",children:p(V,{children:[p(v,{children:["Jumlah warning :"," ",L.length]}),o(K,{bordered:!0,columns:ia,dataSource:L,style:{width:"100%"}})]})},{label:o(H,{count:D.length,color:"rgb(255, 204, 0)",children:"Warning Isian Range Harga"}),key:"3",children:p(V,{children:[p(v,{children:["Jumlah warning range harga :"," ",D.length]}),o(K,{bordered:!0,columns:Ja,dataSource:D,style:{width:"100%"}})]})}]})})]},"range-harga-modal")]})},{Text:oa}=Ka,Ja=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:10,render:(e,c,h)=>h+1},{title:"Komoditas",dataIndex:"komoditas",key:"komoditas",render:(e,c)=>`[${c.id_komoditas}] ${c.nama_komoditas}`},{title:"Harga per Satuan",dataIndex:"harga",key:"harga",width:"20%",render:e=>o(U,{color:"#000",value:Number(e)})},{title:"Rincian",dataIndex:"rincian",key:"rincian",render:(e,c)=>p(oa,{children:[c.rincian,"(",o(U,{value:c.min,color:"red"})," s.d",o(U,{value:c.max,color:"red"}),")"]})}],ia=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:15,render:(e,c,h)=>h+1},{title:"Blok",dataIndex:"blok",key:"blok"},{title:"Variabel",dataIndex:"variable",key:"variable"},{title:"Deskripsi",dataIndex:"rincian",key:"rincian"}];Ua.layout=e=>o(Sa,{user:e.props.auth.user,header:o("h2",{className:"",children:"Dashboard"}),selectedKey:"entri",children:e});export{Ua as default};
