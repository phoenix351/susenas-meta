import{r as d,c as F,j as c,a as i,F as $,b as Ra,g as Z}from"./app-594863b6.js";import{A as Sa}from"./AuthenticatedLayout-231fcac0.js";import{A as Fa,S as Aa,B as ja}from"./Blok1_2-70d12d3e.js";import{D as Ba,W as Ta,B as Ma,a as xa,b as Na,c as Ia,d as H}from"./Blok_QC-433a887d.js";import{M as Ca}from"./Modal-bf79f3e0.js";import{T as U}from"./TextRupiah-c305eedc.js";import{R as Ea}from"./RupiahInput-4ca6b955.js";import{l as $a}from"./lodash-e70d9550.js";import{F as x}from"./index-6ed6d14d.js";import{S as v}from"./index-a6fc668a.js";import{T as V,S as Ka}from"./Table-b6992ce4.js";import{m as aa}from"./index-1014857c.js";import{B as K}from"./index-04d30823.js";import{T as ea}from"./index-f346a5cf.js";import{T as Va}from"./index-c4629e43.js";import{R as La}from"./ReloadOutlined-6e9685ab.js";import"./Sider-dec78fca.js";import"./AntdIcon-175e4fcc.js";import"./LeftOutlined-64be42a7.js";import"./index-9f703954.js";import"./useForceUpdate-6e0d1c94.js";import"./responsiveObserver-358d8654.js";import"./EllipsisOutlined-be96201e.js";import"./Overflow-9030fe5e.js";import"./Keyframes-65d81fe9.js";import"./useFlexGapSupport-d518330e.js";import"./KeyCode-6413d982.js";import"./EditOutlined-07cea508.js";import"./index-695b4647.js";import"./index-7ac5cd43.js";import"./debounce-78fd3332.js";import"./index-bd19dd3e.js";import"./pickAttrs-acf9f8e7.js";import"./TextArea-77b1be0c.js";import"./CheckOutlined-eae11d92.js";import"./CloseOutlined-4e52efbe.js";import"./index-d3be9ffc.js";import"./EyeOutlined-236aefdd.js";import"./CONSTANT-6757a93f.js";import"./index-72fe9e48.js";import"./addEventListener-bf1b69dc.js";import"./index-f50bfcb7.js";import"./index-ff3c1553.js";import"./Skeleton-5b8e9056.js";import"./index-fa5a21dc.js";import"./ExclamationCircleFilled-6172b0ab.js";import"./ActionButton-1e6dc3ca.js";import"./index-79e201cd.js";import"./InfoCircleFilled-9dafb05f.js";import"./styleChecker-3b719b20.js";import"./Dropdown-aef8ec3e.js";import"./PlusOutlined-5aa03c3a.js";import"./Title-c3ea1799.js";const Da=({dataSource:e,id_ruta:u})=>{const[k,j]=d.useState("Belum ada perubahan"),[p]=x.useForm(),m=[{title:"No.",dataIndex:"id",key:"id"},{title:"Nama Komoditas",dataIndex:"nama_komoditas",key:"nama_komoditas"},{title:"Nilai Konsumsi (Rp)",dataIndex:"nilai",key:"nilai",render:(y,S)=>i(Ea,{inputName:`${S.id}-harga`,onChange:g=>{g&&g>=1e7?p.setFields([{name:`${S.id}-harga`,warnings:["Harga diatas batas wajar Rp 10.000.000"]}]):p.setFields([{name:`${S.id}-harga`,warnings:[]}])}})}],A=$a.debounce(async(y,S)=>{try{j("sedang menyimpan perubahan");const g=Object.keys(y)[0].split("-")[0],w=Object.values(y)[0],B={id_ruta:S,id_komoditas:g,harga:w},R=await F.post(route("api.non_mak.konsumsi.store"),B);j("perubahan tersimpan")}catch(g){j("error ketika menyimpan data"),console.log("error when saving data",g)}},1e3);async function h(y){try{const{data:S}=await F.get(route("api.non_mak.konsumsi.fetch",{id_ruta:y})),g=[...e];S.forEach(w=>{const B=`${w.id_komoditas}-harga`;p.setFieldValue(B,w.harga),w.harga&&w.harga>=1e7?p.setFields([{name:`${w.id_komoditas}-harga`,warnings:["Harga diatas batas wajar Rp 10.000.000"]}]):p.setFields([{name:`${w.id_komoditas}-harga`,warnings:[]}])})}catch(S){console.log("error when loading data",S)}finally{}}return d.useEffect(()=>{h(u)},[e]),c(v,{direction:"vertical",style:{width:"100%"},children:[k,c(x,{form:p,onValuesChange:y=>A(y,u),children:[i(V,{dataSource:e,columns:m}),";"]})]})},Oa=({id_ruta:e})=>{d.useState(!1);const[u,k]=d.useState([]);async function j(p){try{const{data:m}=await F.get(route("api.non_mak.komoditas.list"));k(m.map(A=>({...A,harga:0})))}catch(m){console.log("error fetch data",m)}}return d.useEffect(()=>{j()},[]),i(Da,{dataSource:u,id_ruta:e})},ta=[{id:1,nomor:1,rincian:"Padi-padian (R.1)",type:"standar"},{id:2,nomor:2,rincian:"Umbi-umbian (R.8)",type:"standar"},{id:3,nomor:3,rincian:"Ikan/udang/cumi/kerang (R.16)",type:"standar"},{id:4,nomor:4,rincian:"Daging (R.55)",type:"standar"},{id:5,nomor:5,rincian:"Telur dan Susu (R.65)",type:"standar"},{id:6,nomor:6,rincian:"Sayur-sayuran (R.75)",type:"standar"},{id:7,nomor:7,rincian:"Kacang-kacangan (R.102)",type:"standar"},{id:8,nomor:8,rincian:"Buah-buahan (R.110)",type:"standar"},{id:9,nomor:9,rincian:"Minyak dan Kelapa (R.126)",type:"standar"},{id:10,nomor:10,rincian:"Bahan Minuman (R.131)",type:"standar"},{id:11,nomor:11,rincian:"Bumbu-bumbuan (R.139)",type:"standar"},{id:12,nomor:12,rincian:"Bahan Makanan Lainnya (R.154)",type:"standar"},{id:13,nomor:13,rincian:"Makanan dan Minuman Jadi (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:14,nomor:14,rincian:"Rokok dan Tembakau (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:15,nomor:15,rincian:"SUBJUMLAH [R.1 s.d. R.14]",type:"standar"},{id:16,nomor:16,rincian:"RATA-RATA PENGELUARAN MAKANAN SEBULAN [R.15 x 30/7]",type:"average"},{id:17,nomor:17,rincian:"RATA-RATA PENGELUARAN BUKAN MAKANAN SEBULAN [salin dari Blok 4.3.3 rincian 8 kolom 3]",type:"average"},{id:18,nomor:18,rincian:"RATA-RATA PENGELUARAN SEBULAN [R.16 + R17]",type:"average"}],Ha=async(e,u,k,j)=>{const{data:p}=await F.get(route("api.mak.calculate_qc",{id_ruta:e}));let m=[...k];return m[0].value=p.kalori_total/u/7,m[1].value=p.jumlah_komoditas_bahan_makanan,m[2].value=p.jumlah_komoditas_makanan_jadi_rokok,m[3].value=j,m[4].value=m[1].value+m[2].value+m[3].value,m[5].value=Math.round(p.pengeluaran/u),m[6].value=p.kalori_basket/7/u,m},Ua=({data:e,konsumsi_ruta:u,art:k,garis_kemiskinan:j,rekap_konsumsi:p,rekap_konsumsi_art:m})=>{const A={backgroundColor:"#fff",paddingLeft:"10px",paddingRight:"10px",paddingBottom:"15px",width:"100%"},[h]=x.useForm(),[y]=x.useForm(),[S]=x.useForm(),[g]=x.useForm(),[w,B]=d.useState(null),[R,C]=d.useState([]),[N,I]=d.useState(ta.map(t=>({beli:0,produksi:0,total:0}))),[ra,J]=d.useState(!1),[P,na]=d.useState([{rincian:"Kalori per Kapita per Hari",id:0,value:0,dataType:"decimal"},{rincian:"Kalori 52 basket komoditas per Kapita per Hari",id:6,value:0,dataType:"decimal"},{rincian:"Jumlah Komoditas Bahan Makanan/Minuman",id:1,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Makanan/Minuman Jadi dan Rokok",id:2,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Non Makanan [Disalin dari dokumen KP Blok III Rincian 305 ]",id:3,value:0,dataType:"integer",editable:!0},{rincian:"Jumlah Semua Komoditas",id:4,value:0,dataType:"integer"},{rincian:"Pengeluaran per kapita",id:5,value:0,dataType:"rupiah"}]),[sa,la]=d.useState(!1),[da,W]=d.useState(!1),[L,ca]=d.useState([]),[D,ua]=d.useState([]),[O,ma]=d.useState([]),q=()=>{W(!1)},[T,ka]=aa.useMessage(),E=async t=>{try{const r=route("entri.mak.update"),n=await F.patch(r,t,{headers:{"Content-Type":"application/json"}})}catch(r){r.response.status===403&&aa.error({content:"Akun anda tidak boleh mengubah isian ini",key:"403-forbidden",duration:2e3})}},pa=async t=>{try{const r=route("entri.mak.art.update"),n=await F.patch(r,t,{headers:{"Content-Type":"application/json"}})}catch{console.error("Oops terjadi kesalahan dalam menyimpan Kuesioner ART, silahkan hubungi admin")}},ha=async t=>{try{const r=route("entri.mak.konsumsi.store"),{data:n}=await F.patch(r,t,{headers:{"Content-Type":"application/json"}})}catch{T.open({type:"error",key:"4_1",content:"Oops terjadi kesalahan dalam mmenyimpan konsumsi, silahkan hubungi admin"})}},_a=async t=>{try{const r=route("api.entri.inti",t),{data:n}=await F.get(r)}catch{T.open({type:"error",key:"cari",content:"Oops terjadi kesalahan dalam menyimpan blok 4 1 art, silahkan hubungi admin"})}};function Q(t){}const[ba,ya]=d.useState([]),[ga,Pa]=d.useState([{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0}]),fa=async t=>{const n=Object.entries(t).filter(([_,l])=>_.endsWith("volume")&&typeof l=="number"&&l>0).map(async _=>{let l=_[0].split("_")[0],a=Number(_[1])??0;try{const{data:f}=await F.get(route("api.mak.komoditas.kalori.fetch",{id:l}));return a*f}catch{return console.log("error ketika fetch data kalori"),0}});return(await Promise.all(n)).reduce((_,l)=>_+l,0)},z=async()=>{T.loading({content:"Menyimpan data",type:"loading",key:"simpan"});try{const[t,r,n]=await Promise.all([g.submit(),h.submit(),y.submit()]),_=(await F.get(route("api.mak.calculate_qc",{id_ruta:R[0].id_ruta}))).data,l=await Ha(e.id,R.length,P,h.getFieldValue("blokqc_3"));na([...l]),h.setFieldsValue({blokqc_0:l[0].value,blokqc_1:l[1].value,blokqc_2:l[2].value,blokqc_4:l[4].value,blokqc_5:l[5].value,blokqc_6:l[6].value}),B(new Date),Z.get(route("entri.mak.edit",{id:e.id}),{},{preserveState:!0,preserveScroll:!0}),T.open({content:"Data berhasil tersimpan",type:"success",key:"simpan",duration:2})}catch{T.open({content:"Data gagal tersimpan",type:"error",key:"simpan",duration:2})}},G=async()=>{await z();const t=h.getFieldValue("id");try{J(!0);const{data:r}=await F.get(route("api.mak.revalidasi",{id_ruta:t}));ua([...r.evaluasi_rh]),ma([...r.daftar_error]),ca([...r.daftar_warning]),T.open({content:"Revalidasi selesai",type:"success",key:"revalidasi"})}catch(r){console.error("Error submitting forms:",r)}finally{J(!1)}},va=async()=>{const t=y.getFieldsValue();[0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,17].forEach(n=>{let s=[...N];const _=`beli_harga${n}`,l=Object.entries(t).filter(([o])=>o.endsWith(_)&&!o.includes("jumlah")).reduce((o,[,b])=>o+(b||0),0);s[n].beli=l;const a=`produksi_harga${n}`,f=Object.entries(t).filter(([o])=>o.endsWith(a)&&!o.includes("jumlah")).reduce((o,[,b])=>o+(b||0),0);s[n].produksi=f,n<=14&&(s[n].total=s[n].beli+s[n].produksi),s[14]=s.slice(0,14).reduce((o,b)=>({beli:o.beli+b.beli,produksi:o.produksi+b.produksi,total:o.total+b.total}),{beli:0,produksi:0,total:0}),s[15].total=Math.round(s[14].total*30/7),s[17].total=s[15].total+s[16].total,I(s)})};d.useEffect(()=>{let t=[...N];R==null||R.forEach((n,s)=>{g.setFieldValue(`${s}-id_art`,n.id),g.setFieldValue(`${s}-nama`,n.nama)});const r=R==null?void 0:R.reduce((n,s)=>(Object.values(s.rekap).forEach((_,l)=>{n[l]=n[l]||{beli:0,produksi:0,total:0},n[l].beli+=_.beli,n[l].produksi+=_.produksi,n[l].total+=_.total}),n),[]);t[12]=r?r[0]:0,t[13]=r?r[1]:0,t[14]=t.slice(0,14).reduce((n,s)=>({beli:s?n.beli+s.beli:0,produksi:s?n.produksi+s.produksi:0,total:s?n.total+s.total:0}),{beli:0,produksi:0,total:0}),t[15].total=Math.round(t[14].total*30/7),t[17].total=t[15].total+t[16].total,I(t)},[R]),d.useRef(!1);const wa=t=>{t.ctrlKey&&t.key==="s"&&(t.preventDefault(),h.submit())};d.useEffect(()=>{(()=>{if(k=k.map(f=>({...f,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}})),k.length<1&&C(f=>[...f,{id:"",id_ruta:e.id,nama:e.r110,nomor_art:0,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}}]),k.length>0){var a=[...k];m.map(o=>({id_art:o.id_art,id_kelompok:o.id_kelompok,beli:Number(o.beli),produksi:Number(o.produksi)})).forEach(o=>(a=a.map(b=>{if(b.id===o.id_art)try{b.rekap[o.id_kelompok].produksi=o.produksi,b.rekap[o.id_kelompok].beli=o.beli,b.rekap[o.id_kelompok].total=o.beli+o.produksi}catch{console.log({element:o,art:b})}return b}),o)),C(a)}})(),document.addEventListener("keydown",wa),h.setFieldsValue(e);let r=[...N];p.map(a=>({id_kelompok:a.id_kelompok,beli:Number(a.beli),produksi:Number(a.produksi)})).forEach(a=>{r[a.id_kelompok].beli=a.beli,r[a.id_kelompok].produksi=a.produksi,r[a.id_kelompok].total=a.produksi+a.beli}),r[16].total=e.blok4_32_16_total,I(r),h.setFieldValue("wtf_26",j),y.setFieldsValue({id_ruta:e.id,hal10_jml_komoditas:e.hal10_jml_komoditas??void 0,hal8_jml_komoditas:e.hal8_jml_komoditas??void 0,hal6_jml_komoditas:e.hal6_jml_komoditas??void 0,hal4_jml_komoditas:e.hal4_jml_komoditas??void 0,hal2_jml_komoditas:e.hal2_jml_komoditas??void 0});const s=[1,8,16],l=u.map(a=>({[`${s.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_beli_harga${a.id_kelompok}`]:a.harga_beli,[`${s.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_produksi_harga${a.id_kelompok}`]:a.harga_produksi,[`${a.id_komoditas}_total_harga`]:a.harga_total,[`${a.id_komoditas}_total_harga_calculated`]:a.harga_produksi+a.harga_beli,[`${a.id_komoditas}_item`]:a.item,[`${a.id_komoditas}_satuan`]:a.satuan,[`${a.id_komoditas}_beli_volume`]:a.volume_beli,[`${a.id_komoditas}_produksi_volume`]:a.volume_produksi,[`${a.id_komoditas}_total_volume`]:a.volume_total})).reduce((a,f)=>{for(const o in f)f.hasOwnProperty(o)&&(a[o]=f[o]);return a},{});y.setFieldsValue(l),g.setFieldsValue({id_ruta:e.id}),B(new Date(e.updated_at)),Y(e.r203)},[]);const[M,X]=d.useState(!0);function Y(t){if(t=="1"){X(!0);return}X(!1)}return c($,{children:[ka,i(Ra,{title:"Entri Kuesioner Inti"}),c(v,{style:{width:"100%",minHeight:"300px",padding:"10px 15px"},direction:"vertical",children:[c(v,{style:{width:"100%",justifyContent:"space-between"},direction:"horizontal",children:[i(v,{children:c(K,{onClick:()=>Z.get(route("entri",{kode_kabkot:h.getFieldValue("kode_kabkot"),nks:h.getFieldValue("nks"),semester:2})),children:[i(Fa,{})," Kembali"]})}),c(v,{direction:"horizontal",style:{width:"100%",justifyContent:"end"},children:["Last Saved :",(w==null?void 0:w.toLocaleDateString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}))||"Never",c(K,{type:"primary",onClick:z,children:[i(Aa,{})," Simpan"]}),c(K,{type:"primary",style:{backgroundColor:"#e64d00"},onClick:async()=>{W(!0),sa||(G(),la(!0))},children:[i(Ba,{}),"Evaluasi"]})]})]}),i(ea,{onChange:Q,type:"card",items:[{label:"Blok I, II",key:"1",children:i(ja,{ubahStatusCacah:Y,tabContentStyle:A,form:h,onFinish:E,setDaftarArt:C,editable:!1,identitas_wilayah:{desa:e.desa,kode_desa:e.kode_desa,kec:e.kec,kode_kec:e.kode_kec}})},{label:"Worksheet",key:"2",children:i(Ta,{tabContentStyle:A,form:h,onFinish:E}),disabled:!M},{label:"Blok IV.1",key:"3",children:i(Ma,{onFinish:ha,form:y,tabContentStyle:A,calculate:va,subTotalHarga:ga,rekapMak:N,setRekapMak:I}),disabled:!M},{label:"Non Makanan",key:"7",children:i(Oa,{id_ruta:e.id}),disabled:!M},{label:"Blok IV.1 ART",key:"4",children:i(xa,{id_ruta:e.id,tabContentStyle:A,form:S,artForm:g,onFinish:_a,artFormFinish:pa,rekapArt:ba,setRekapArt:ya,daftarArt:R,setDaftarArt:C,calculateKalori:fa}),disabled:!M},{label:"Blok IV.3",key:"5",children:i(Na,{tabContentStyle:A,form:h,onFinish:E,daftarArt:R,rekapMak:N,daftarRincian432:ta,setRekapMak:I}),disabled:!M},{label:"Blok QC",key:"6",children:i(Ia,{tabContentStyle:A,form:h,onFinish:E,daftarQc:P}),disabled:!M}]})]}),c(Ca,{cancelText:"Tutup",okText:"",handleCancel:q,confirmLoadingModal:!1,openModal:da,handleOk:q,title:"Daftar Evaluasi",width:"1200px",noFooter:!0,children:[c(v,{style:{marginBottom:"20px",width:"100%",justifyContent:"end"},children:[c(K,{type:"primary",onClick:G,children:[i(La,{})," Revalidasi"]}),i(oa,{children:"Klik ini untuk melakukan revalidasi ulang"})]}),ra?c(v,{style:{width:"100%",justifyContent:"center"},direction:"vertical",children:[i(v,{style:{width:"100%",justifyContent:"center"},children:i(Ka,{size:"large"})}),i(v,{style:{width:"100%",justifyContent:"center"},children:"Sedang melakukan evaluasi terhadap isian, harap bersabar :)"})]}):i(v,{style:{width:"100%"},direction:"vertical",children:i(ea,{onChange:Q,type:"card",tabBarStyle:{padding:0,margin:0},items:[{label:i(H,{count:O.length,children:"Error Isian"}),key:"1",children:c($,{children:[c(v,{children:["Jumlah error :"," ",O.length]}),i(V,{bordered:!0,columns:ia,dataSource:O,style:{width:"100%"}})]})},{label:i(H,{count:L.length,color:"rgb(255, 204, 0)",children:"Warning Isian"}),key:"2",children:c($,{children:[c(v,{children:["Jumlah warning :"," ",L.length]}),i(V,{bordered:!0,columns:ia,dataSource:L,style:{width:"100%"}})]})},{label:i(H,{count:D.length,color:"rgb(255, 204, 0)",children:"Warning Isian Range Harga"}),key:"3",children:c($,{children:[c(v,{children:["Jumlah warning range harga :"," ",D.length]}),i(V,{bordered:!0,columns:Ja,dataSource:D,style:{width:"100%"}})]})}]})})]},"range-harga-modal")]})},{Text:oa}=Va,Ja=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:10,render:(e,u,k)=>k+1},{title:"Komoditas",dataIndex:"komoditas",key:"komoditas",render:(e,u)=>`[${u.id_komoditas}] ${u.nama_komoditas}`},{title:"Harga per Satuan",dataIndex:"harga",key:"harga",width:"20%",render:e=>i(U,{color:"#000",value:Number(e)})},{title:"Rincian",dataIndex:"rincian",key:"rincian",render:(e,u)=>c(oa,{children:[u.rincian,"(",i(U,{value:u.min,color:"red"})," s.d",i(U,{value:u.max,color:"red"}),")"]})}],ia=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:15,render:(e,u,k)=>k+1},{title:"Blok",dataIndex:"blok",key:"blok"},{title:"Variabel",dataIndex:"variable",key:"variable"},{title:"Deskripsi",dataIndex:"rincian",key:"rincian"}];Ua.layout=e=>i(Sa,{user:e.props.auth.user,header:i("h2",{className:"",children:"Dashboard"}),selectedKey:"entri",children:e});export{Ua as default};
