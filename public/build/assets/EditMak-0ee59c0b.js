import{r as u,j as d,F as M,a as n,b as fa,g as z,c as f}from"./app-99d6f54e.js";import{A as va}from"./AuthenticatedLayout-a777ef79.js";import{A as Ra,S as wa,B as Sa}from"./Blok1_2-0d918b80.js";import{D as Aa,W as Fa,B as Ta,a as Ba,b as ja,c as Ma,d as L}from"./Blok_QC-ee6df77a.js";import{M as xa}from"./Modal-d97c92b5.js";import{T as $}from"./TextRupiah-09ab2db5.js";import{F as x}from"./index-d1e9936c.js";import{m as G}from"./index-d3d40e08.js";import{S as b}from"./index-fc009cdd.js";import{B as I}from"./useFlexGapSupport-cdcedcf9.js";import{T as X}from"./index-b384c841.js";import{S as Ia,T as O}from"./Table-ff610d5b.js";import{T as Ea}from"./index-f35f262a.js";import{R as Ka}from"./ReloadOutlined-16a78b30.js";import"./Sider-c9e9b410.js";import"./AntdIcon-069f8aa0.js";import"./index-b6d8a6c3.js";import"./useForceUpdate-a4092761.js";import"./KeyCode-6413d982.js";import"./index-620f7a56.js";import"./index-5dd3d3e8.js";import"./debounce-d266a78a.js";import"./index-75fad3be.js";import"./pickAttrs-24d99b4f.js";import"./TextArea-5f862156.js";import"./useLocale-066e56a5.js";import"./CheckOutlined-5c39cba1.js";import"./CloseOutlined-33a60630.js";import"./index-078d12d2.js";import"./EyeOutlined-a733697e.js";import"./CONSTANT-b7a876ac.js";import"./index-4a21b5cf.js";import"./addEventListener-7807ca64.js";import"./index-946120b1.js";import"./index-dee122bc.js";import"./RupiahInput-70f10f15.js";import"./lodash-7d3428d8.js";import"./index-08a0f095.js";import"./ExclamationCircleFilled-e36dbf42.js";import"./ActionButton-477564ba.js";import"./index-d7e46d9c.js";import"./InfoCircleFilled-b4144afa.js";import"./styleChecker-f5dc05ae.js";const Y=[{id:1,nomor:1,rincian:"Padi-padian (R.1)",type:"standar"},{id:2,nomor:2,rincian:"Umbi-umbian (R.8)",type:"standar"},{id:3,nomor:3,rincian:"Ikan/udang/cumi/kerang (R.16)",type:"standar"},{id:4,nomor:4,rincian:"Daging (R.55)",type:"standar"},{id:5,nomor:5,rincian:"Telur dan Susu (R.65)",type:"standar"},{id:6,nomor:6,rincian:"Sayur-sayuran (R.75)",type:"standar"},{id:7,nomor:7,rincian:"Kacang-kacangan (R.102)",type:"standar"},{id:8,nomor:8,rincian:"Buah-buahan (R.110)",type:"standar"},{id:9,nomor:9,rincian:"Minyak dan Kelapa (R.126)",type:"standar"},{id:10,nomor:10,rincian:"Bahan Minuman (R.131)",type:"standar"},{id:11,nomor:11,rincian:"Bumbu-bumbuan (R.139)",type:"standar"},{id:12,nomor:12,rincian:"Bahan Makanan Lainnya (R.154)",type:"standar"},{id:13,nomor:13,rincian:"Makanan dan Minuman Jadi (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:14,nomor:14,rincian:"Rokok dan Tembakau (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:15,nomor:15,rincian:"SUBJUMLAH [R.1 s.d. R.14]",type:"standar"},{id:16,nomor:16,rincian:"RATA-RATA PENGELUARAN MAKANAN SEBULAN [R.15 x 30/7]",type:"average"},{id:17,nomor:17,rincian:"RATA-RATA PENGELUARAN BUKAN MAKANAN SEBULAN [salin dari Blok 4.3.3 rincian 8 kolom 3]",type:"average"},{id:18,nomor:18,rincian:"RATA-RATA PENGELUARAN SEBULAN [R.16 + R17]",type:"average"}],Va=async(l,c,y,E)=>{const{data:v}=await f.get(route("api.mak.calculate_qc",{id_ruta:l}));let p=[...y];return p[0].value=v.kalori_total/c/7,p[1].value=v.jumlah_komoditas_bahan_makanan,p[2].value=v.jumlah_komoditas_makanan_jadi_rokok,p[3].value=E,p[4].value=p[1].value+p[2].value+p[3].value,p[5].value=Math.round(v.pengeluaran/c),p[6].value=v.kalori_basket/7/c,p},Ca=({data:l,konsumsi_ruta:c,art:y,garis_kemiskinan:E,rekap_konsumsi:v,rekap_konsumsi_art:p})=>{const R={backgroundColor:"#fff",paddingLeft:"10px",paddingRight:"10px",paddingBottom:"15px",width:"100%"},[m]=x.useForm(),[S]=x.useForm(),[ea]=x.useForm(),[A]=x.useForm(),[K,D]=u.useState(null),[g,B]=u.useState([]),[F,T]=u.useState(Y.map(e=>({beli:0,produksi:0,total:0}))),[ta,U]=u.useState(!1),[H,ia]=u.useState([{rincian:"Kalori per Kapita per Hari",id:0,value:0,dataType:"decimal"},{rincian:"Kalori 52 basket komoditas per Kapita per Hari",id:6,value:0,dataType:"decimal"},{rincian:"Jumlah Komoditas Bahan Makanan/Minuman",id:1,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Makanan/Minuman Jadi dan Rokok",id:2,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Non Makanan [Disalin dari dokumen KP Blok III Rincian 305 ]",id:3,value:0,dataType:"integer",editable:!0},{rincian:"Jumlah Semua Komoditas",id:4,value:0,dataType:"integer"},{rincian:"Pengeluaran per kapita",id:5,value:0,dataType:"rupiah"}]),[oa,ra]=u.useState(!1),[na,J]=u.useState(!1),[V,la]=u.useState([]),[C,sa]=u.useState([]),[N,da]=u.useState([]),P=()=>{J(!1)},[w,ua]=G.useMessage(),j=async e=>{try{const t=route("entri.mak.update"),o=await f.patch(t,e,{headers:{"Content-Type":"application/json"}})}catch(t){t.response.status===403&&G.error({content:"Akun anda tidak boleh mengubah isian ini",key:"403-forbidden",duration:2e3})}},ca=async e=>{try{const t=route("entri.mak.art.update"),o=await f.patch(t,e,{headers:{"Content-Type":"application/json"}})}catch{console.error("Oops terjadi kesalahan dalam menyimpan Kuesioner ART, silahkan hubungi admin")}},ka=async e=>{try{const t=route("entri.mak.konsumsi.store"),{data:o}=await f.patch(t,e,{headers:{"Content-Type":"application/json"}})}catch{w.open({type:"error",key:"4_1",content:"Oops terjadi kesalahan dalam mmenyimpan konsumsi, silahkan hubungi admin"})}},pa=async e=>{try{const t=route("api.entri.inti",e),{data:o}=await f.get(t)}catch{w.open({type:"error",key:"cari",content:"Oops terjadi kesalahan dalam menyimpan blok 4 1 art, silahkan hubungi admin"})}};function W(e){}const[ma,ha]=u.useState([]),[_a,La]=u.useState([{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0}]),ba=async e=>{const o=Object.entries(e).filter(([k,s])=>k.endsWith("volume")&&typeof s=="number"&&s>0).map(async k=>{let s=k[0].split("_")[0],a=Number(k[1])??0;try{const{data:h}=await f.get(route("api.mak.komoditas.kalori.fetch",{id:s}));return a*h}catch{return console.log("error ketika fetch data kalori"),0}});return(await Promise.all(o)).reduce((k,s)=>k+s,0)},q=async()=>{w.loading({content:"Menyimpan data",type:"loading",key:"simpan"});try{const[e,t,o]=await Promise.all([A.submit(),m.submit(),S.submit()]),k=(await f.get(route("api.mak.calculate_qc",{id_ruta:g[0].id_ruta}))).data,s=await Va(l.id,g.length,H,m.getFieldValue("blokqc_3"));ia([...s]),m.setFieldsValue({blokqc_0:s[0].value,blokqc_1:s[1].value,blokqc_2:s[2].value,blokqc_4:s[4].value,blokqc_5:s[5].value,blokqc_6:s[6].value}),D(new Date),z.get(route("entri.mak.edit",{id:l.id}),{},{preserveState:!0,preserveScroll:!0}),w.open({content:"Data berhasil tersimpan",type:"success",key:"simpan",duration:2})}catch{w.open({content:"Data gagal tersimpan",type:"error",key:"simpan",duration:2})}},Q=async()=>{await q();const e=m.getFieldValue("id");try{U(!0);const{data:t}=await f.get(route("api.mak.revalidasi",{id_ruta:e}));sa([...t.evaluasi_rh]),da([...t.daftar_error]),la([...t.daftar_warning]),w.open({content:"Revalidasi selesai",type:"success",key:"revalidasi"})}catch(t){console.error("Error submitting forms:",t)}finally{U(!1)}},ya=async()=>{const e=S.getFieldsValue();[0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,17].forEach(o=>{let r=[...F];const k=`beli_harga${o}`,s=Object.entries(e).filter(([i])=>i.endsWith(k)&&!i.includes("jumlah")).reduce((i,[,_])=>i+(_||0),0);r[o].beli=s;const a=`produksi_harga${o}`,h=Object.entries(e).filter(([i])=>i.endsWith(a)&&!i.includes("jumlah")).reduce((i,[,_])=>i+(_||0),0);r[o].produksi=h,o<=14&&(r[o].total=r[o].beli+r[o].produksi),r[14]=r.slice(0,14).reduce((i,_)=>({beli:i.beli+_.beli,produksi:i.produksi+_.produksi,total:i.total+_.total}),{beli:0,produksi:0,total:0}),r[15].total=Math.round(r[14].total*30/7),r[17].total=r[15].total+r[16].total,T(r)})};u.useEffect(()=>{let e=[...F];g==null||g.forEach((o,r)=>{A.setFieldValue(`${r}-id_art`,o.id),A.setFieldValue(`${r}-nama`,o.nama)});const t=g==null?void 0:g.reduce((o,r)=>(Object.values(r.rekap).forEach((k,s)=>{o[s]=o[s]||{beli:0,produksi:0,total:0},o[s].beli+=k.beli,o[s].produksi+=k.produksi,o[s].total+=k.total}),o),[]);e[12]=t?t[0]:0,e[13]=t?t[1]:0,e[14]=e.slice(0,14).reduce((o,r)=>({beli:r?o.beli+r.beli:0,produksi:r?o.produksi+r.produksi:0,total:r?o.total+r.total:0}),{beli:0,produksi:0,total:0}),e[15].total=Math.round(e[14].total*30/7),e[17].total=e[15].total+e[16].total,T(e)},[g]),u.useRef(!1);const ga=e=>{e.ctrlKey&&e.key==="s"&&(e.preventDefault(),m.submit())};return u.useEffect(()=>{(()=>{if(y=y.map(h=>({...h,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}})),y.length<1&&B(h=>[...h,{id:"",id_ruta:l.id,nama:l.r110,nomor_art:0,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}}]),y.length>0){var a=[...y];p.map(i=>({id_art:i.id_art,id_kelompok:i.id_kelompok,beli:Number(i.beli),produksi:Number(i.produksi)})).forEach(i=>(a=a.map(_=>(_.id===i.id_art&&(_.rekap[i.id_kelompok].produksi=i.produksi,_.rekap[i.id_kelompok].beli=i.beli,_.rekap[i.id_kelompok].total=i.beli+i.produksi),_)),i)),B(a)}})(),document.addEventListener("keydown",ga),m.setFieldsValue(l);let t=[...F];v.map(a=>({id_kelompok:a.id_kelompok,beli:Number(a.beli),produksi:Number(a.produksi)})).forEach(a=>{t[a.id_kelompok].beli=a.beli,t[a.id_kelompok].produksi=a.produksi,t[a.id_kelompok].total=a.produksi+a.beli}),t[16].total=l.blok4_32_16_total,T(t),m.setFieldValue("wtf_26",E),S.setFieldsValue({id_ruta:l.id,hal10_jml_komoditas:l.hal10_jml_komoditas??void 0,hal8_jml_komoditas:l.hal8_jml_komoditas??void 0,hal6_jml_komoditas:l.hal6_jml_komoditas??void 0,hal4_jml_komoditas:l.hal4_jml_komoditas??void 0,hal2_jml_komoditas:l.hal2_jml_komoditas??void 0});const r=[1,8,16],s=c.map(a=>({[`${r.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_beli_harga${a.id_kelompok}`]:a.harga_beli,[`${r.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_produksi_harga${a.id_kelompok}`]:a.harga_produksi,[`${a.id_komoditas}_total_harga`]:a.harga_total,[`${a.id_komoditas}_total_harga_calculated`]:a.harga_produksi+a.harga_beli,[`${a.id_komoditas}_item`]:a.item,[`${a.id_komoditas}_satuan`]:a.satuan,[`${a.id_komoditas}_beli_volume`]:a.volume_beli,[`${a.id_komoditas}_produksi_volume`]:a.volume_produksi,[`${a.id_komoditas}_total_volume`]:a.volume_total})).reduce((a,h)=>{for(const i in h)h.hasOwnProperty(i)&&(a[i]=h[i]);return a},{});S.setFieldsValue(s),A.setFieldsValue({id_ruta:l.id}),D(new Date(l.updated_at))},[]),d(M,{children:[ua,n(fa,{title:"Entri Kuesioner Inti"}),d(b,{style:{width:"100%",minHeight:"300px",padding:"10px 15px"},direction:"vertical",children:[d(b,{style:{width:"100%",justifyContent:"space-between"},direction:"horizontal",children:[n(b,{children:d(I,{onClick:()=>z.get(route("entri",{kode_kabkot:m.getFieldValue("kode_kabkot"),nks:m.getFieldValue("nks"),semester:2})),children:[n(Ra,{})," Kembali"]})}),d(b,{direction:"horizontal",style:{width:"100%",justifyContent:"end"},children:["Last Saved :",(K==null?void 0:K.toLocaleDateString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}))||"Never",d(I,{type:"primary",onClick:q,children:[n(wa,{})," Simpan"]}),d(I,{type:"primary",style:{backgroundColor:"#e64d00"},onClick:async()=>{J(!0),oa||(Q(),ra(!0))},children:[n(Aa,{}),"Evaluasi"]})]})]}),n(X,{onChange:W,type:"card",items:[{label:"Blok I, II",key:"1",children:n(Sa,{tabContentStyle:R,form:m,onFinish:j,setDaftarArt:B,editable:!1,identitas_wilayah:{desa:l.desa,kode_desa:l.kode_desa,kec:l.kec,kode_kec:l.kode_kec}})},{label:"Worksheet",key:"2",children:n(Fa,{tabContentStyle:R,form:m,onFinish:j})},{label:"Blok IV.1",key:"3",children:n(Ta,{onFinish:ka,form:S,tabContentStyle:R,calculate:ya,subTotalHarga:_a,rekapMak:F,setRekapMak:T})},{label:"Blok IV.1 ART",key:"4",children:n(Ba,{tabContentStyle:R,form:ea,artForm:A,onFinish:pa,artFormFinish:ca,rekapArt:ma,setRekapArt:ha,daftarArt:g,setDaftarArt:B,calculateKalori:ba})},{label:"Blok IV.3",key:"5",children:n(ja,{tabContentStyle:R,form:m,onFinish:j,daftarArt:g,rekapMak:F,daftarRincian432:Y,setRekapMak:T})},{label:"Blok QC",key:"6",children:n(Ma,{tabContentStyle:R,form:m,onFinish:j,daftarQc:H})}]})]}),d(xa,{cancelText:"Tutup",okText:"",handleCancel:P,confirmLoadingModal:!1,openModal:na,handleOk:P,title:"Daftar Evaluasi",width:"1200px",children:[d(b,{style:{marginBottom:"20px",width:"100%",justifyContent:"end"},children:[d(I,{type:"primary",onClick:Q,children:[n(Ka,{})," Revalidasi"]}),n(aa,{children:"Klik ini untuk melakukan revalidasi ulang"})]}),ta?d(b,{style:{width:"100%",justifyContent:"center"},direction:"vertical",children:[n(b,{style:{width:"100%",justifyContent:"center"},children:n(Ia,{size:"large"})}),n(b,{style:{width:"100%",justifyContent:"center"},children:"Sedang melakukan evaluasi terhadap isian, harap bersabar :)"})]}):n(b,{style:{width:"100%"},direction:"vertical",children:n(X,{onChange:W,type:"card",items:[{label:n(L,{count:N.length,children:"Error Isian"}),key:"1",children:d(M,{children:[d(b,{children:["Jumlah error :"," ",N.length]}),n(O,{bordered:!0,columns:Z,dataSource:N,style:{width:"100%"}})]})},{label:n(L,{count:V.length,color:"rgb(255, 204, 0)",children:"Warning Isian"}),key:"2",children:d(M,{children:[d(b,{children:["Jumlah warning :"," ",V.length]}),n(O,{bordered:!0,columns:Z,dataSource:V,style:{width:"100%"}})]})},{label:n(L,{count:C.length,color:"rgb(255, 204, 0)",children:"Warning Isian Range Harga"}),key:"3",children:d(M,{children:[d(b,{children:["Jumlah warning range harga :"," ",C.length]}),n(O,{bordered:!0,columns:Na,dataSource:C,style:{width:"100%"}})]})}]})})]},"range-harga-modal")]})},{Text:aa}=Ea,Na=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:10,render:(l,c,y)=>y+1},{title:"Komoditas",dataIndex:"komoditas",key:"komoditas",render:(l,c)=>`[${c.id_komoditas}] ${c.nama_komoditas}`},{title:"Harga per Satuan",dataIndex:"harga",key:"harga",width:"20%",render:l=>n($,{color:"#000",value:Number(l)})},{title:"Rincian",dataIndex:"rincian",key:"rincian",render:(l,c)=>d(aa,{children:[c.rincian,"(",n($,{value:c.min,color:"red"})," s.d",n($,{value:c.max,color:"red"}),")"]})}],Z=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:15,render:(l,c,y)=>y+1},{title:"Blok",dataIndex:"blok",key:"blok"},{title:"Variabel",dataIndex:"variable",key:"variable"},{title:"Deskripsi",dataIndex:"rincian",key:"rincian"}];Ca.layout=l=>n(va,{user:l.props.auth.user,header:n("h2",{className:"",children:"Dashboard"}),selectedKey:"entri",children:l});export{Ca as default};
