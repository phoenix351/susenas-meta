import{r as u,j as d,F as x,a as l,b as wa,g as Y,c as f}from"./app-5488b642.js";import{A as Sa}from"./AuthenticatedLayout-0604ef72.js";import{A as Aa,S as Fa,B as Ba}from"./Blok1_2-70d1f728.js";import{D as Ta,W as ja,B as Ma,a as xa,b as Ca,c as Ia,d as $}from"./Blok_QC-3c2ff89c.js";import{M as Ea}from"./Modal-c288aab5.js";import{T as O}from"./TextRupiah-eaec57f2.js";import{F as C}from"./index-15b8efa8.js";import{m as Z}from"./index-beb8f2ba.js";import{S as b}from"./index-5044f9b1.js";import{B as I}from"./index-f5c87f49.js";import{T as aa}from"./index-5a0ef9d8.js";import{S as Ka,T as D}from"./Table-0a8c4964.js";import{T as Va}from"./index-7894210b.js";import{R as Na}from"./ReloadOutlined-f6cad169.js";import"./Sider-c7d462db.js";import"./AntdIcon-54e0d8e3.js";import"./LeftOutlined-4d2db241.js";import"./index-e2f14928.js";import"./useForceUpdate-d6383011.js";import"./responsiveObserver-ffd7fd36.js";import"./EllipsisOutlined-be03f216.js";import"./Overflow-7fa2eed2.js";import"./Keyframes-421582cf.js";import"./useFlexGapSupport-fd3dfe61.js";import"./KeyCode-6413d982.js";import"./EditOutlined-1e0d7ba9.js";import"./index-22a70d2d.js";import"./index-a3685fac.js";import"./debounce-0972cf6c.js";import"./index-37249b66.js";import"./pickAttrs-3c94ba05.js";import"./TextArea-196bc487.js";import"./CheckOutlined-d1e320cb.js";import"./CloseOutlined-ccf3a8cb.js";import"./index-7dec5dd9.js";import"./EyeOutlined-e1394764.js";import"./CONSTANT-6757a93f.js";import"./index-6221efe6.js";import"./addEventListener-d2128f2c.js";import"./index-88a2a96f.js";import"./index-04613c7f.js";import"./Skeleton-94b47089.js";import"./RupiahInput-03cafb8c.js";import"./lodash-0e341bba.js";import"./index-dc31e81b.js";import"./ExclamationCircleFilled-6b922640.js";import"./ActionButton-fc65696f.js";import"./index-6a173523.js";import"./InfoCircleFilled-055a9aa6.js";import"./PlusOutlined-d6b8022d.js";import"./Dropdown-e1f76901.js";import"./styleChecker-ac0d96b1.js";import"./Title-0c5d90fc.js";const ea=[{id:1,nomor:1,rincian:"Padi-padian (R.1)",type:"standar"},{id:2,nomor:2,rincian:"Umbi-umbian (R.8)",type:"standar"},{id:3,nomor:3,rincian:"Ikan/udang/cumi/kerang (R.16)",type:"standar"},{id:4,nomor:4,rincian:"Daging (R.55)",type:"standar"},{id:5,nomor:5,rincian:"Telur dan Susu (R.65)",type:"standar"},{id:6,nomor:6,rincian:"Sayur-sayuran (R.75)",type:"standar"},{id:7,nomor:7,rincian:"Kacang-kacangan (R.102)",type:"standar"},{id:8,nomor:8,rincian:"Buah-buahan (R.110)",type:"standar"},{id:9,nomor:9,rincian:"Minyak dan Kelapa (R.126)",type:"standar"},{id:10,nomor:10,rincian:"Bahan Minuman (R.131)",type:"standar"},{id:11,nomor:11,rincian:"Bumbu-bumbuan (R.139)",type:"standar"},{id:12,nomor:12,rincian:"Bahan Makanan Lainnya (R.154)",type:"standar"},{id:13,nomor:13,rincian:"Makanan dan Minuman Jadi (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:14,nomor:14,rincian:"Rokok dan Tembakau (Blok IV.3.1 Baris Jumlah)",type:"standar"},{id:15,nomor:15,rincian:"SUBJUMLAH [R.1 s.d. R.14]",type:"standar"},{id:16,nomor:16,rincian:"RATA-RATA PENGELUARAN MAKANAN SEBULAN [R.15 x 30/7]",type:"average"},{id:17,nomor:17,rincian:"RATA-RATA PENGELUARAN BUKAN MAKANAN SEBULAN [salin dari Blok 4.3.3 rincian 8 kolom 3]",type:"average"},{id:18,nomor:18,rincian:"RATA-RATA PENGELUARAN SEBULAN [R.16 + R17]",type:"average"}],La=async(o,c,y,E)=>{const{data:v}=await f.get(route("api.mak.calculate_qc",{id_ruta:o}));let m=[...y];return m[0].value=v.kalori_total/c/7,m[1].value=v.jumlah_komoditas_bahan_makanan,m[2].value=v.jumlah_komoditas_makanan_jadi_rokok,m[3].value=E,m[4].value=m[1].value+m[2].value+m[3].value,m[5].value=Math.round(v.pengeluaran/c),m[6].value=v.kalori_basket/7/c,m},$a=({data:o,konsumsi_ruta:c,art:y,garis_kemiskinan:E,rekap_konsumsi:v,rekap_konsumsi_art:m})=>{const R={backgroundColor:"#fff",paddingLeft:"10px",paddingRight:"10px",paddingBottom:"15px",width:"100%"},[h]=C.useForm(),[S]=C.useForm(),[oa]=C.useForm(),[A]=C.useForm(),[K,U]=u.useState(null),[g,j]=u.useState([]),[F,B]=u.useState(ea.map(e=>({beli:0,produksi:0,total:0}))),[ra,H]=u.useState(!1),[J,na]=u.useState([{rincian:"Kalori per Kapita per Hari",id:0,value:0,dataType:"decimal"},{rincian:"Kalori 52 basket komoditas per Kapita per Hari",id:6,value:0,dataType:"decimal"},{rincian:"Jumlah Komoditas Bahan Makanan/Minuman",id:1,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Makanan/Minuman Jadi dan Rokok",id:2,value:0,dataType:"integer"},{rincian:"Jumlah Komoditas Non Makanan [Disalin dari dokumen KP Blok III Rincian 305 ]",id:3,value:0,dataType:"integer",editable:!0},{rincian:"Jumlah Semua Komoditas",id:4,value:0,dataType:"integer"},{rincian:"Pengeluaran per kapita",id:5,value:0,dataType:"rupiah"}]),[la,sa]=u.useState(!1),[da,P]=u.useState(!1),[V,ua]=u.useState([]),[N,ca]=u.useState([]),[L,ka]=u.useState([]),W=()=>{P(!1)},[w,pa]=Z.useMessage(),M=async e=>{try{const i=route("entri.mak.update"),r=await f.patch(i,e,{headers:{"Content-Type":"application/json"}})}catch(i){i.response.status===403&&Z.error({content:"Akun anda tidak boleh mengubah isian ini",key:"403-forbidden",duration:2e3})}},ma=async e=>{try{const i=route("entri.mak.art.update"),r=await f.patch(i,e,{headers:{"Content-Type":"application/json"}})}catch{console.error("Oops terjadi kesalahan dalam menyimpan Kuesioner ART, silahkan hubungi admin")}},ha=async e=>{try{const i=route("entri.mak.konsumsi.store"),{data:r}=await f.patch(i,e,{headers:{"Content-Type":"application/json"}})}catch{w.open({type:"error",key:"4_1",content:"Oops terjadi kesalahan dalam mmenyimpan konsumsi, silahkan hubungi admin"})}},_a=async e=>{try{const i=route("api.entri.inti",e),{data:r}=await f.get(i)}catch{w.open({type:"error",key:"cari",content:"Oops terjadi kesalahan dalam menyimpan blok 4 1 art, silahkan hubungi admin"})}};function q(e){}const[ba,ya]=u.useState([]),[ga,Da]=u.useState([{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0},{beli:0,produksi:0,total:0}]),fa=async e=>{const r=Object.entries(e).filter(([k,s])=>k.endsWith("volume")&&typeof s=="number"&&s>0).map(async k=>{let s=k[0].split("_")[0],a=Number(k[1])??0;try{const{data:_}=await f.get(route("api.mak.komoditas.kalori.fetch",{id:s}));return a*_}catch{return console.log("error ketika fetch data kalori"),0}});return(await Promise.all(r)).reduce((k,s)=>k+s,0)},Q=async()=>{w.loading({content:"Menyimpan data",type:"loading",key:"simpan"});try{const[e,i,r]=await Promise.all([A.submit(),h.submit(),S.submit()]),k=(await f.get(route("api.mak.calculate_qc",{id_ruta:g[0].id_ruta}))).data,s=await La(o.id,g.length,J,h.getFieldValue("blokqc_3"));na([...s]),h.setFieldsValue({blokqc_0:s[0].value,blokqc_1:s[1].value,blokqc_2:s[2].value,blokqc_4:s[4].value,blokqc_5:s[5].value,blokqc_6:s[6].value}),U(new Date),Y.get(route("entri.mak.edit",{id:o.id}),{},{preserveState:!0,preserveScroll:!0}),w.open({content:"Data berhasil tersimpan",type:"success",key:"simpan",duration:2})}catch{w.open({content:"Data gagal tersimpan",type:"error",key:"simpan",duration:2})}},z=async()=>{await Q();const e=h.getFieldValue("id");try{H(!0);const{data:i}=await f.get(route("api.mak.revalidasi",{id_ruta:e}));ca([...i.evaluasi_rh]),ka([...i.daftar_error]),ua([...i.daftar_warning]),w.open({content:"Revalidasi selesai",type:"success",key:"revalidasi"})}catch(i){console.error("Error submitting forms:",i)}finally{H(!1)}},va=async()=>{const e=S.getFieldsValue();[0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,17].forEach(r=>{let n=[...F];const k=`beli_harga${r}`,s=Object.entries(e).filter(([t])=>t.endsWith(k)&&!t.includes("jumlah")).reduce((t,[,p])=>t+(p||0),0);n[r].beli=s;const a=`produksi_harga${r}`,_=Object.entries(e).filter(([t])=>t.endsWith(a)&&!t.includes("jumlah")).reduce((t,[,p])=>t+(p||0),0);n[r].produksi=_,r<=14&&(n[r].total=n[r].beli+n[r].produksi),n[14]=n.slice(0,14).reduce((t,p)=>({beli:t.beli+p.beli,produksi:t.produksi+p.produksi,total:t.total+p.total}),{beli:0,produksi:0,total:0}),n[15].total=Math.round(n[14].total*30/7),n[17].total=n[15].total+n[16].total,B(n)})};u.useEffect(()=>{let e=[...F];g==null||g.forEach((r,n)=>{A.setFieldValue(`${n}-id_art`,r.id),A.setFieldValue(`${n}-nama`,r.nama)});const i=g==null?void 0:g.reduce((r,n)=>(Object.values(n.rekap).forEach((k,s)=>{r[s]=r[s]||{beli:0,produksi:0,total:0},r[s].beli+=k.beli,r[s].produksi+=k.produksi,r[s].total+=k.total}),r),[]);e[12]=i?i[0]:0,e[13]=i?i[1]:0,e[14]=e.slice(0,14).reduce((r,n)=>({beli:n?r.beli+n.beli:0,produksi:n?r.produksi+n.produksi:0,total:n?r.total+n.total:0}),{beli:0,produksi:0,total:0}),e[15].total=Math.round(e[14].total*30/7),e[17].total=e[15].total+e[16].total,B(e)},[g]),u.useRef(!1);const Ra=e=>{e.ctrlKey&&e.key==="s"&&(e.preventDefault(),h.submit())};u.useEffect(()=>{(()=>{if(y=y.map(_=>({..._,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}})),y.length<1&&j(_=>[..._,{id:"",id_ruta:o.id,nama:o.r110,nomor_art:0,rekap:{12:{produksi:0,beli:0,total:0},13:{produksi:0,beli:0,total:0}}}]),y.length>0){var a=[...y];m.map(t=>({id_art:t.id_art,id_kelompok:t.id_kelompok,beli:Number(t.beli),produksi:Number(t.produksi)})).forEach(t=>(a=a.map(p=>{if(p.id===t.id_art)try{p.rekap[t.id_kelompok].produksi=t.produksi,p.rekap[t.id_kelompok].beli=t.beli,p.rekap[t.id_kelompok].total=t.beli+t.produksi}catch{console.log({element:t,art:p})}return p}),t)),j(a)}})(),document.addEventListener("keydown",Ra),h.setFieldsValue(o);let i=[...F];v.map(a=>({id_kelompok:a.id_kelompok,beli:Number(a.beli),produksi:Number(a.produksi)})).forEach(a=>{i[a.id_kelompok].beli=a.beli,i[a.id_kelompok].produksi=a.produksi,i[a.id_kelompok].total=a.produksi+a.beli}),i[16].total=o.blok4_32_16_total,B(i),h.setFieldValue("wtf_26",E),S.setFieldsValue({id_ruta:o.id,hal10_jml_komoditas:o.hal10_jml_komoditas??void 0,hal8_jml_komoditas:o.hal8_jml_komoditas??void 0,hal6_jml_komoditas:o.hal6_jml_komoditas??void 0,hal4_jml_komoditas:o.hal4_jml_komoditas??void 0,hal2_jml_komoditas:o.hal2_jml_komoditas??void 0});const n=[1,8,16],s=c.map(a=>({[`${n.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_beli_harga${a.id_kelompok}`]:a.harga_beli,[`${n.includes(a.id_komoditas)?"jumlah":""}${a.id_komoditas}_produksi_harga${a.id_kelompok}`]:a.harga_produksi,[`${a.id_komoditas}_total_harga`]:a.harga_total,[`${a.id_komoditas}_total_harga_calculated`]:a.harga_produksi+a.harga_beli,[`${a.id_komoditas}_item`]:a.item,[`${a.id_komoditas}_satuan`]:a.satuan,[`${a.id_komoditas}_beli_volume`]:a.volume_beli,[`${a.id_komoditas}_produksi_volume`]:a.volume_produksi,[`${a.id_komoditas}_total_volume`]:a.volume_total})).reduce((a,_)=>{for(const t in _)_.hasOwnProperty(t)&&(a[t]=_[t]);return a},{});S.setFieldsValue(s),A.setFieldsValue({id_ruta:o.id}),U(new Date(o.updated_at)),X(o.r203)},[]);const[T,G]=u.useState(!0);function X(e){if(e=="1"){G(!0);return}G(!1)}return d(x,{children:[pa,l(wa,{title:"Entri Kuesioner Inti"}),d(b,{style:{width:"100%",minHeight:"300px",padding:"10px 15px"},direction:"vertical",children:[d(b,{style:{width:"100%",justifyContent:"space-between"},direction:"horizontal",children:[l(b,{children:d(I,{onClick:()=>Y.get(route("entri",{kode_kabkot:h.getFieldValue("kode_kabkot"),nks:h.getFieldValue("nks"),semester:2})),children:[l(Aa,{})," Kembali"]})}),d(b,{direction:"horizontal",style:{width:"100%",justifyContent:"end"},children:["Last Saved :",(K==null?void 0:K.toLocaleDateString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}))||"Never",d(I,{type:"primary",onClick:Q,children:[l(Fa,{})," Simpan"]}),d(I,{type:"primary",style:{backgroundColor:"#e64d00"},onClick:async()=>{P(!0),la||(z(),sa(!0))},children:[l(Ta,{}),"Evaluasi"]})]})]}),l(aa,{onChange:q,type:"card",items:[{label:"Blok I, II",key:"1",children:l(Ba,{ubahStatusCacah:X,tabContentStyle:R,form:h,onFinish:M,setDaftarArt:j,editable:!1,identitas_wilayah:{desa:o.desa,kode_desa:o.kode_desa,kec:o.kec,kode_kec:o.kode_kec}})},{label:"Worksheet",key:"2",children:l(ja,{tabContentStyle:R,form:h,onFinish:M}),disabled:!T},{label:"Blok IV.1",key:"3",children:l(Ma,{onFinish:ha,form:S,tabContentStyle:R,calculate:va,subTotalHarga:ga,rekapMak:F,setRekapMak:B}),disabled:!T},{label:"Blok IV.1 ART",key:"4",children:l(xa,{id_ruta:o.id,tabContentStyle:R,form:oa,artForm:A,onFinish:_a,artFormFinish:ma,rekapArt:ba,setRekapArt:ya,daftarArt:g,setDaftarArt:j,calculateKalori:fa}),disabled:!T},{label:"Blok IV.3",key:"5",children:l(Ca,{tabContentStyle:R,form:h,onFinish:M,daftarArt:g,rekapMak:F,daftarRincian432:ea,setRekapMak:B}),disabled:!T},{label:"Blok QC",key:"6",children:l(Ia,{tabContentStyle:R,form:h,onFinish:M,daftarQc:J}),disabled:!T}]})]}),d(Ea,{cancelText:"Tutup",okText:"",handleCancel:W,confirmLoadingModal:!1,openModal:da,handleOk:W,title:"Daftar Evaluasi",width:"1200px",noFooter:!0,children:[d(b,{style:{marginBottom:"20px",width:"100%",justifyContent:"end"},children:[d(I,{type:"primary",onClick:z,children:[l(Na,{})," Revalidasi"]}),l(ia,{children:"Klik ini untuk melakukan revalidasi ulang"})]}),ra?d(b,{style:{width:"100%",justifyContent:"center"},direction:"vertical",children:[l(b,{style:{width:"100%",justifyContent:"center"},children:l(Ka,{size:"large"})}),l(b,{style:{width:"100%",justifyContent:"center"},children:"Sedang melakukan evaluasi terhadap isian, harap bersabar :)"})]}):l(b,{style:{width:"100%"},direction:"vertical",children:l(aa,{onChange:q,type:"card",tabBarStyle:{padding:0,margin:0},items:[{label:l($,{count:L.length,children:"Error Isian"}),key:"1",children:d(x,{children:[d(b,{children:["Jumlah error :"," ",L.length]}),l(D,{bordered:!0,columns:ta,dataSource:L,style:{width:"100%"}})]})},{label:l($,{count:V.length,color:"rgb(255, 204, 0)",children:"Warning Isian"}),key:"2",children:d(x,{children:[d(b,{children:["Jumlah warning :"," ",V.length]}),l(D,{bordered:!0,columns:ta,dataSource:V,style:{width:"100%"}})]})},{label:l($,{count:N.length,color:"rgb(255, 204, 0)",children:"Warning Isian Range Harga"}),key:"3",children:d(x,{children:[d(b,{children:["Jumlah warning range harga :"," ",N.length]}),l(D,{bordered:!0,columns:Oa,dataSource:N,style:{width:"100%"}})]})}]})})]},"range-harga-modal")]})},{Text:ia}=Va,Oa=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:10,render:(o,c,y)=>y+1},{title:"Komoditas",dataIndex:"komoditas",key:"komoditas",render:(o,c)=>`[${c.id_komoditas}] ${c.nama_komoditas}`},{title:"Harga per Satuan",dataIndex:"harga",key:"harga",width:"20%",render:o=>l(O,{color:"#000",value:Number(o)})},{title:"Rincian",dataIndex:"rincian",key:"rincian",render:(o,c)=>d(ia,{children:[c.rincian,"(",l(O,{value:c.min,color:"red"})," s.d",l(O,{value:c.max,color:"red"}),")"]})}],ta=[{title:"Nomor",dataIndex:"nomor",key:"nomor",width:15,render:(o,c,y)=>y+1},{title:"Blok",dataIndex:"blok",key:"blok"},{title:"Variabel",dataIndex:"variable",key:"variable"},{title:"Deskripsi",dataIndex:"rincian",key:"rincian"}];$a.layout=o=>l(Sa,{user:o.props.auth.user,header:l("h2",{className:"",children:"Dashboard"}),selectedKey:"entri",children:o});export{$a as default};
